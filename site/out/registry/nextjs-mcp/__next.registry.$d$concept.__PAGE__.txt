1:"$Sreact.fragment"
7:I[27655,["/_next/static/chunks/1d56de6fa4bb4a40.js"],"PlatformTabs"]
b:I[71831,["/_next/static/chunks/e57f8bd634e3e83c.js","/_next/static/chunks/152d0cd9196fc828.js"],"OutletBoundary"]
c:"$Sreact.suspense"
0:{"buildId":"SJGAMULNE9-l0J7tDiAh1","rsc":["$","$1","c",{"children":[["$","main",null,{"className":"min-h-screen bg-background","children":["$","div",null,{"className":"mx-auto flex w-full max-w-6xl flex-col gap-10 px-6 py-16","children":[["$","header",null,{"className":"space-y-4","children":[["$","p",null,{"className":"text-sm font-semibold uppercase tracking-wide text-muted-foreground","children":"Concept"}],["$","div",null,{"className":"space-y-3","children":[["$","h1",null,{"className":"text-3xl font-semibold tracking-tight","children":"Next.js MCP"}],["$","p",null,{"className":"text-muted-foreground","children":"Install the Next.js DevTools MCP server for OpenCode."}]]}],["$","div",null,{"className":"flex flex-wrap gap-2","children":[["$","div","mcp",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"mcp"}],["$","div","nextjs",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"nextjs"}],["$","div","opencode",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"opencode"}],["$","div","devtools",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"devtools"}],["$","div","config",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"config"}]]}]]}],["$","section",null,{"className":"grid gap-8 lg:grid-cols-[1.2fr_0.8fr]","children":[["$","div",null,{"className":"space-y-6","children":[["$","div",null,{"className":"rounded-xl border bg-card text-card-foreground shadow-sm","children":[["$","div",null,{"className":"flex flex-col space-y-1.5 p-6","children":[["$","h3",null,{"className":"text-lg font-semibold leading-none","children":"Why teams adopt it"}],["$","p",null,{"className":"text-sm text-muted-foreground","children":"The outcomes this concept is designed to unlock."}]]}],["$","div",null,{"className":"p-6 pt-0","children":["$","ul",null,{"className":"space-y-2 text-sm text-muted-foreground","children":[["$","li","Expose dev-server diagnostics to OpenCode agents.",{"children":["• ","Expose dev-server diagnostics to OpenCode agents."]}],["$","li","Centralize MCP config with a repeatable install flow.",{"children":["• ","Centralize MCP config with a repeatable install flow."]}],["$","li","Keep MCP config consistent across projects.",{"children":["• ","Keep MCP config consistent across projects."]}]]}]}]]}],["$","div",null,{"className":"rounded-xl border bg-card text-card-foreground shadow-sm","children":[["$","div",null,{"className":"flex flex-col space-y-1.5 p-6","children":[["$","h3",null,{"className":"text-lg font-semibold leading-none","children":"What ships with it"}],["$","p",null,{"className":"text-sm text-muted-foreground","children":"Core capabilities included in the OpenCode variant."}]]}],["$","div",null,{"className":"p-6 pt-0","children":["$","ul",null,{"className":"space-y-2 text-sm text-muted-foreground","children":[["$","li","A reusable merge script that updates opencode.json/jsonc.",{"children":["• ","A reusable merge script that updates opencode.json/jsonc."]}],["$","li","A payload file that registers next-devtools-mcp as a local MCP server.",{"children":["• ","A payload file that registers next-devtools-mcp as a local MCP server."]}]]}]}]]}],["$","div",null,{"className":"rounded-xl border bg-card text-card-foreground shadow-sm","children":[["$","div",null,{"className":"flex flex-col space-y-1.5 p-6","children":["$","h3",null,{"className":"text-lg font-semibold leading-none","children":"Common use cases"}]}],["$","div",null,{"className":"p-6 pt-0","children":["$","ul",null,{"className":"space-y-2 text-sm text-muted-foreground","children":[["$","li","Enable OpenCode to read Next.js errors and logs during dev.",{"children":["• ","Enable OpenCode to read Next.js errors and logs during dev."]}],"$L2","$L3"]}]}]]}]]}],"$L4"]}]]}]}],["$L5"],"$L6"]}],"loading":null,"isPartial":false}
2:["$","li","Query routes and page metadata directly from the dev server.",{"children":["• ","Query routes and page metadata directly from the dev server."]}]
3:["$","li","Share a consistent MCP setup across teams and repos.",{"children":["• ","Share a consistent MCP setup across teams and repos."]}]
8:T1b92,#!/usr/bin/env node

// scripts/merge-mcp.ts
import fs from "node:fs";
import path from "node:path";
var args = process.argv.slice(2);
var options = {
  keep: false,
  force: false
};
var payloadArgs = [];
for (const arg of args) {
  if (arg === "--keep") {
    options.keep = true;
    continue;
  }
  if (arg === "--force") {
    options.force = true;
    continue;
  }
  if (arg.startsWith("-")) {
    console.error(`Unknown option: ${arg}`);
    process.exit(1);
  }
  payloadArgs.push(arg);
}
function detectEol(text) {
  return text.includes(`\r
`) ? `\r
` : `
`;
}
function stripJsonComments(input) {
  let out = "";
  let inString = false;
  let stringChar = "";
  let escaped = false;
  for (let i = 0;i < input.length; i += 1) {
    const char = input[i];
    const next = input[i + 1];
    if (inString) {
      out += char;
      if (escaped) {
        escaped = false;
      } else if (char === "\\") {
        escaped = true;
      } else if (char === stringChar) {
        inString = false;
      }
      continue;
    }
    if (char === '"' || char === "'") {
      inString = true;
      stringChar = char;
      out += char;
      continue;
    }
    if (char === "/" && next === "/") {
      while (i < input.length && input[i] !== `
`) {
        i += 1;
      }
      out += `
`;
      continue;
    }
    if (char === "/" && next === "*") {
      i += 2;
      while (i < input.length && !(input[i] === "*" && input[i + 1] === "/")) {
        i += 1;
      }
      i += 1;
      continue;
    }
    out += char;
  }
  return out;
}
function stripTrailingCommas(input) {
  let out = "";
  let inString = false;
  let stringChar = "";
  let escaped = false;
  for (let i = 0;i < input.length; i += 1) {
    const char = input[i];
    if (inString) {
      out += char;
      if (escaped) {
        escaped = false;
      } else if (char === "\\") {
        escaped = true;
      } else if (char === stringChar) {
        inString = false;
      }
      continue;
    }
    if (char === '"' || char === "'") {
      inString = true;
      stringChar = char;
      out += char;
      continue;
    }
    if (char === ",") {
      let j = i + 1;
      while (j < input.length && /\s/.test(input[j] ?? "")) {
        j += 1;
      }
      if (j < input.length && (input[j] === "}" || input[j] === "]")) {
        continue;
      }
    }
    out += char;
  }
  return out;
}
function parseJsonc(text, label) {
  const sanitized = stripTrailingCommas(stripJsonComments(text));
  let data;
  try {
    data = JSON.parse(sanitized);
  } catch (error) {
    const message = error instanceof Error ? error.message : "Unknown JSON parse error";
    throw new Error(`Failed to parse ${label}: ${message}`);
  }
  if (!data || typeof data !== "object") {
    throw new Error(`Expected ${label} to be an object.`);
  }
  return data;
}
function readPayload(filePath) {
  const raw = fs.readFileSync(filePath, "utf8");
  const data = parseJsonc(raw, filePath);
  return data;
}
function resolvePayloads(cwd, explicit) {
  if (explicit.length) {
    return explicit.map((item) => path.resolve(cwd, item));
  }
  const payloadDir = path.join(cwd, ".opencode", "mcp");
  if (!fs.existsSync(payloadDir)) {
    return [];
  }
  const entries = fs.readdirSync(payloadDir, { withFileTypes: true });
  return entries.filter((entry) => entry.isFile() && (entry.name.endsWith(".json") || entry.name.endsWith(".jsonc"))).map((entry) => path.join(payloadDir, entry.name));
}
function getConfigPath(cwd) {
  const jsoncPath = path.join(cwd, "opencode.jsonc");
  if (fs.existsSync(jsoncPath))
    return jsoncPath;
  return path.join(cwd, "opencode.json");
}
function ensureDir(dirPath) {
  fs.mkdirSync(dirPath, { recursive: true });
}
function main() {
  const cwd = process.cwd();
  const payloadFiles = resolvePayloads(cwd, payloadArgs);
  if (!payloadFiles.length) {
    console.log("No MCP payloads found. Nothing to merge.");
    return;
  }
  const payloads = payloadFiles.map((filePath) => ({ filePath, payload: readPayload(filePath) }));
  const mcpEntries = [];
  for (const { filePath, payload } of payloads) {
    if (!payload.mcp || typeof payload.mcp !== "object") {
      console.warn(`Skipping ${filePath}: missing mcp object.`);
      continue;
    }
    for (const [name, entry] of Object.entries(payload.mcp)) {
      if (!entry || typeof entry !== "object") {
        console.warn(`Skipping ${filePath}: mcp.${name} is not an object.`);
        continue;
      }
      mcpEntries.push([name, entry]);
    }
  }
  if (!mcpEntries.length) {
    console.log("No valid MCP entries found. Nothing to merge.");
    return;
  }
  const configPath = getConfigPath(cwd);
  const configExists = fs.existsSync(configPath);
  const configText = configExists ? fs.readFileSync(configPath, "utf8") : `{}
`;
  const eol = detectEol(configText);
  const configData = parseJsonc(configText, path.basename(configPath));
  const configObject = configData;
  const existingMcp = configObject.mcp && typeof configObject.mcp === "object" ? configObject.mcp : {};
  const added = [];
  const skipped = [];
  const updated = [];
  for (const [name, entry] of mcpEntries) {
    const exists = Object.prototype.hasOwnProperty.call(existingMcp, name);
    if (exists && !options.force) {
      skipped.push(name);
      continue;
    }
    existingMcp[name] = entry;
    if (exists) {
      updated.push(name);
    } else {
      added.push(name);
    }
  }
  if (added.length || updated.length) {
    configObject.mcp = existingMcp;
    const normalized = JSON.stringify(configObject, null, 2);
    const output = normalized.endsWith(eol) ? normalized : `${normalized}${eol}`;
    fs.writeFileSync(configPath, output, "utf8");
    console.log(`Updated ${path.basename(configPath)}.`);
  } else {
    console.log(`No changes needed in ${path.basename(configPath)}.`);
  }
  if (!options.keep) {
    const payloadDir = path.join(cwd, ".opencode", "mcp");
    const appliedDir = path.join(payloadDir, ".applied");
    ensureDir(appliedDir);
    for (const filePath of payloadFiles) {
      const relative = path.relative(payloadDir, filePath);
      if (relative.startsWith("..") || relative.startsWith(`.${path.sep}`)) {
        continue;
      }
      if (relative.startsWith(`.applied${path.sep}`)) {
        continue;
      }
      const baseName = path.basename(filePath);
      let target = path.join(appliedDir, baseName);
      if (fs.existsSync(target)) {
        const stamp = Date.now();
        target = path.join(appliedDir, `${baseName}.${stamp}`);
      }
      fs.renameSync(filePath, target);
    }
  }
  if (added.length) {
    console.log(`Added MCP servers: ${added.join(", ")}`);
  }
  if (updated.length) {
    console.log(`Updated MCP servers: ${updated.join(", ")}`);
  }
  if (skipped.length) {
    console.log(`Skipped existing MCP servers: ${skipped.join(", ")}`);
  }
}
try {
  main();
} catch (error) {
  const message = error instanceof Error ? error.message : String(error);
  console.error(`MCP merge failed: ${message}`);
  process.exit(1);
}
9:T11d66,<pre class="shiki vitesse-light" style="background-color:#ffffff;color:#393a34" tabindex="0"><code><span class="line"><span style="color:#A0ADA0">#!/usr/bin/env node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0">// scripts/merge-mcp.ts</span></span>
<span class="line"><span style="color:#1E754F">import</span><span style="color:#B07D48"> fs</span><span style="color:#1E754F"> from</span><span style="color:#B5695977"> "</span><span style="color:#B56959">node:fs</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">import</span><span style="color:#B07D48"> path</span><span style="color:#1E754F"> from</span><span style="color:#B5695977"> "</span><span style="color:#B56959">node:path</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">var</span><span style="color:#B07D48"> args</span><span style="color:#999999"> =</span><span style="color:#B07D48"> process</span><span style="color:#999999">.</span><span style="color:#B07D48">argv</span><span style="color:#999999">.</span><span style="color:#59873A">slice</span><span style="color:#999999">(</span><span style="color:#2F798A">2</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">var</span><span style="color:#B07D48"> options</span><span style="color:#999999"> =</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#998418">  keep</span><span style="color:#999999">:</span><span style="color:#1E754F"> false</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#998418">  force</span><span style="color:#999999">:</span><span style="color:#1E754F"> false</span></span>
<span class="line"><span style="color:#999999">};</span></span>
<span class="line"><span style="color:#AB5959">var</span><span style="color:#B07D48"> payloadArgs</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#1E754F">for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#B07D48"> arg</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> args</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">arg</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">--keep</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    options</span><span style="color:#999999">.</span><span style="color:#B07D48">keep</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">arg</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">--force</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    options</span><span style="color:#999999">.</span><span style="color:#B07D48">force</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">arg</span><span style="color:#999999">.</span><span style="color:#59873A">startsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">-</span><span style="color:#B5695977">"</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">error</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Unknown option: </span><span style="color:#1E754F">${</span><span style="color:#B56959">arg</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#B07D48">    process</span><span style="color:#999999">.</span><span style="color:#59873A">exit</span><span style="color:#999999">(</span><span style="color:#2F798A">1</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#B07D48">  payloadArgs</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">(</span><span style="color:#B07D48">arg</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> detectEol</span><span style="color:#999999">(</span><span style="color:#B07D48">text</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> text</span><span style="color:#999999">.</span><span style="color:#59873A">includes</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#A65E2B">\r</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">)</span><span style="color:#AB5959"> ?</span><span style="color:#B5695977"> `</span><span style="color:#A65E2B">\r</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#AB5959"> :</span><span style="color:#B5695977"> `</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> stripJsonComments</span><span style="color:#999999">(</span><span style="color:#B07D48">input</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> out</span><span style="color:#999999"> =</span><span style="color:#B5695977"> ""</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> stringChar</span><span style="color:#999999"> =</span><span style="color:#B5695977"> ""</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">  for</span><span style="color:#999999"> (</span><span style="color:#AB5959">let</span><span style="color:#B07D48"> i</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><span style="color:#B07D48">i</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">;</span><span style="color:#B07D48"> i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> char</span><span style="color:#999999"> =</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#999999">];</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> next</span><span style="color:#999999"> =</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#999999">];</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">inString</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">escaped</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span><span style="color:#1E754F"> else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#A65E2B">\\</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span><span style="color:#1E754F"> else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B07D48"> stringChar</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> '</span><span style="color:#B56959">"</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">'</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">      stringChar</span><span style="color:#999999"> =</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">/</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B07D48"> next</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">/</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">      while</span><span style="color:#999999"> (</span><span style="color:#B07D48">i</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#999999">]</span><span style="color:#AB5959"> !==</span><span style="color:#B5695977"> `</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B5695977"> `</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">/</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B07D48"> next</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">*</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 2</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      while</span><span style="color:#999999"> (</span><span style="color:#B07D48">i</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#AB5959"> !</span><span style="color:#999999">(</span><span style="color:#B07D48">input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#999999">]</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">*</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#999999">]</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">/</span><span style="color:#B5695977">"</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#B07D48">      i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#B07D48">    out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> out</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> stripTrailingCommas</span><span style="color:#999999">(</span><span style="color:#B07D48">input</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> out</span><span style="color:#999999"> =</span><span style="color:#B5695977"> ""</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> stringChar</span><span style="color:#999999"> =</span><span style="color:#B5695977"> ""</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">  for</span><span style="color:#999999"> (</span><span style="color:#AB5959">let</span><span style="color:#B07D48"> i</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><span style="color:#B07D48">i</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">;</span><span style="color:#B07D48"> i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> char</span><span style="color:#999999"> =</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#999999">];</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">inString</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">escaped</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span><span style="color:#1E754F"> else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#A65E2B">\\</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span><span style="color:#1E754F"> else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B07D48"> stringChar</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> '</span><span style="color:#B56959">"</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">'</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">      stringChar</span><span style="color:#999999"> =</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">,</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">      let</span><span style="color:#B07D48"> j</span><span style="color:#999999"> =</span><span style="color:#B07D48"> i</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      while</span><span style="color:#999999"> (</span><span style="color:#B07D48">j</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B5695977"> /</span><span style="color:#5A6AA6">\s</span><span style="color:#B5695977">/</span><span style="color:#999999">.</span><span style="color:#59873A">test</span><span style="color:#999999">(</span><span style="color:#B07D48">input</span><span style="color:#999999">[</span><span style="color:#B07D48">j</span><span style="color:#999999">]</span><span style="color:#AB5959"> ??</span><span style="color:#B5695977"> ""</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        j</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">j</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#999999"> (</span><span style="color:#B07D48">input</span><span style="color:#999999">[</span><span style="color:#B07D48">j</span><span style="color:#999999">]</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">}</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">j</span><span style="color:#999999">]</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">]</span><span style="color:#B5695977">"</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">        continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#B07D48">    out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> out</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> parseJsonc</span><span style="color:#999999">(</span><span style="color:#B07D48">text</span><span style="color:#999999">,</span><span style="color:#B07D48"> label</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> sanitized</span><span style="color:#999999"> =</span><span style="color:#59873A"> stripTrailingCommas</span><span style="color:#999999">(</span><span style="color:#59873A">stripJsonComments</span><span style="color:#999999">(</span><span style="color:#B07D48">text</span><span style="color:#999999">));</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> data</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">  try</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    data</span><span style="color:#999999"> =</span><span style="color:#B07D48"> JSON</span><span style="color:#999999">.</span><span style="color:#59873A">parse</span><span style="color:#999999">(</span><span style="color:#B07D48">sanitized</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span><span style="color:#1E754F"> catch</span><span style="color:#999999"> (</span><span style="color:#B07D48">error</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> message</span><span style="color:#999999"> =</span><span style="color:#B07D48"> error</span><span style="color:#AB5959"> instanceof</span><span style="color:#2E8F82"> Error</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> error</span><span style="color:#999999">.</span><span style="color:#B07D48">message</span><span style="color:#AB5959"> :</span><span style="color:#B5695977"> "</span><span style="color:#B56959">Unknown JSON parse error</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    throw</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> Error</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Failed to parse </span><span style="color:#1E754F">${</span><span style="color:#B56959">label</span><span style="color:#1E754F">}</span><span style="color:#B56959">: </span><span style="color:#1E754F">${</span><span style="color:#B56959">message</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">data</span><span style="color:#AB5959"> ||</span><span style="color:#AB5959"> typeof</span><span style="color:#B07D48"> data</span><span style="color:#AB5959"> !==</span><span style="color:#B5695977"> "</span><span style="color:#B56959">object</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">    throw</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> Error</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Expected </span><span style="color:#1E754F">${</span><span style="color:#B56959">label</span><span style="color:#1E754F">}</span><span style="color:#B56959"> to be an object.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> data</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> readPayload</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> raw</span><span style="color:#999999"> =</span><span style="color:#B07D48"> fs</span><span style="color:#999999">.</span><span style="color:#59873A">readFileSync</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">utf8</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> data</span><span style="color:#999999"> =</span><span style="color:#59873A"> parseJsonc</span><span style="color:#999999">(</span><span style="color:#B07D48">raw</span><span style="color:#999999">,</span><span style="color:#B07D48"> filePath</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> data</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> resolvePayloads</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B07D48"> explicit</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">explicit</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#B07D48"> explicit</span><span style="color:#999999">.</span><span style="color:#59873A">map</span><span style="color:#999999">((</span><span style="color:#B07D48">item</span><span style="color:#999999">)</span><span style="color:#999999"> =></span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">resolve</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B07D48"> item</span><span style="color:#999999">));</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> payloadDir</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">.opencode</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">mcp</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">fs</span><span style="color:#999999">.</span><span style="color:#59873A">existsSync</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> entries</span><span style="color:#999999"> =</span><span style="color:#B07D48"> fs</span><span style="color:#999999">.</span><span style="color:#59873A">readdirSync</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">,</span><span style="color:#999999"> {</span><span style="color:#998418"> withFileTypes</span><span style="color:#999999">:</span><span style="color:#1E754F"> true</span><span style="color:#999999"> });</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> entries</span><span style="color:#999999">.</span><span style="color:#59873A">filter</span><span style="color:#999999">((</span><span style="color:#B07D48">entry</span><span style="color:#999999">)</span><span style="color:#999999"> =></span><span style="color:#B07D48"> entry</span><span style="color:#999999">.</span><span style="color:#59873A">isFile</span><span style="color:#999999">()</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#999999"> (</span><span style="color:#B07D48">entry</span><span style="color:#999999">.</span><span style="color:#B07D48">name</span><span style="color:#999999">.</span><span style="color:#59873A">endsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">.json</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> entry</span><span style="color:#999999">.</span><span style="color:#B07D48">name</span><span style="color:#999999">.</span><span style="color:#59873A">endsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">.jsonc</span><span style="color:#B5695977">"</span><span style="color:#999999">))).</span><span style="color:#59873A">map</span><span style="color:#999999">((</span><span style="color:#B07D48">entry</span><span style="color:#999999">)</span><span style="color:#999999"> =></span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">,</span><span style="color:#B07D48"> entry</span><span style="color:#999999">.</span><span style="color:#B07D48">name</span><span style="color:#999999">));</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> getConfigPath</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> jsoncPath</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">opencode.jsonc</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">fs</span><span style="color:#999999">.</span><span style="color:#59873A">existsSync</span><span style="color:#999999">(</span><span style="color:#B07D48">jsoncPath</span><span style="color:#999999">))</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#B07D48"> jsoncPath</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">opencode.json</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> ensureDir</span><span style="color:#999999">(</span><span style="color:#B07D48">dirPath</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">  fs</span><span style="color:#999999">.</span><span style="color:#59873A">mkdirSync</span><span style="color:#999999">(</span><span style="color:#B07D48">dirPath</span><span style="color:#999999">,</span><span style="color:#999999"> {</span><span style="color:#998418"> recursive</span><span style="color:#999999">:</span><span style="color:#1E754F"> true</span><span style="color:#999999"> });</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> main</span><span style="color:#999999">()</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> cwd</span><span style="color:#999999"> =</span><span style="color:#B07D48"> process</span><span style="color:#999999">.</span><span style="color:#59873A">cwd</span><span style="color:#999999">();</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> payloadFiles</span><span style="color:#999999"> =</span><span style="color:#59873A"> resolvePayloads</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B07D48"> payloadArgs</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">payloadFiles</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">No MCP payloads found. Nothing to merge.</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> payloads</span><span style="color:#999999"> =</span><span style="color:#B07D48"> payloadFiles</span><span style="color:#999999">.</span><span style="color:#59873A">map</span><span style="color:#999999">((</span><span style="color:#B07D48">filePath</span><span style="color:#999999">)</span><span style="color:#999999"> =></span><span style="color:#999999"> ({</span><span style="color:#B07D48"> filePath</span><span style="color:#999999">,</span><span style="color:#998418"> payload</span><span style="color:#999999">:</span><span style="color:#59873A"> readPayload</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">)</span><span style="color:#999999"> }));</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> mcpEntries</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#1E754F">  for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#999999"> {</span><span style="color:#B07D48"> filePath</span><span style="color:#999999">,</span><span style="color:#B07D48"> payload</span><span style="color:#999999"> }</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> payloads</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">payload</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> ||</span><span style="color:#AB5959"> typeof</span><span style="color:#B07D48"> payload</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> !==</span><span style="color:#B5695977"> "</span><span style="color:#B56959">object</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      console</span><span style="color:#999999">.</span><span style="color:#59873A">warn</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Skipping </span><span style="color:#1E754F">${</span><span style="color:#B56959">filePath</span><span style="color:#1E754F">}</span><span style="color:#B56959">: missing mcp object.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#999999"> [</span><span style="color:#B07D48">name</span><span style="color:#999999">,</span><span style="color:#B07D48"> entry</span><span style="color:#999999">]</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> Object</span><span style="color:#999999">.</span><span style="color:#59873A">entries</span><span style="color:#999999">(</span><span style="color:#B07D48">payload</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">entry</span><span style="color:#AB5959"> ||</span><span style="color:#AB5959"> typeof</span><span style="color:#B07D48"> entry</span><span style="color:#AB5959"> !==</span><span style="color:#B5695977"> "</span><span style="color:#B56959">object</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        console</span><span style="color:#999999">.</span><span style="color:#59873A">warn</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Skipping </span><span style="color:#1E754F">${</span><span style="color:#B56959">filePath</span><span style="color:#1E754F">}</span><span style="color:#B56959">: mcp.</span><span style="color:#1E754F">${</span><span style="color:#B56959">name</span><span style="color:#1E754F">}</span><span style="color:#B56959"> is not an object.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">        continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#B07D48">      mcpEntries</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">([</span><span style="color:#B07D48">name</span><span style="color:#999999">,</span><span style="color:#B07D48"> entry</span><span style="color:#999999">]);</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">mcpEntries</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">No valid MCP entries found. Nothing to merge.</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configPath</span><span style="color:#999999"> =</span><span style="color:#59873A"> getConfigPath</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configExists</span><span style="color:#999999"> =</span><span style="color:#B07D48"> fs</span><span style="color:#999999">.</span><span style="color:#59873A">existsSync</span><span style="color:#999999">(</span><span style="color:#B07D48">configPath</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configText</span><span style="color:#999999"> =</span><span style="color:#B07D48"> configExists</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> fs</span><span style="color:#999999">.</span><span style="color:#59873A">readFileSync</span><span style="color:#999999">(</span><span style="color:#B07D48">configPath</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">utf8</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#AB5959"> :</span><span style="color:#B5695977"> `</span><span style="color:#B56959">{}</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> eol</span><span style="color:#999999"> =</span><span style="color:#59873A"> detectEol</span><span style="color:#999999">(</span><span style="color:#B07D48">configText</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configData</span><span style="color:#999999"> =</span><span style="color:#59873A"> parseJsonc</span><span style="color:#999999">(</span><span style="color:#B07D48">configText</span><span style="color:#999999">,</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">basename</span><span style="color:#999999">(</span><span style="color:#B07D48">configPath</span><span style="color:#999999">));</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configObject</span><span style="color:#999999"> =</span><span style="color:#B07D48"> configData</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> existingMcp</span><span style="color:#999999"> =</span><span style="color:#B07D48"> configObject</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#AB5959"> typeof</span><span style="color:#B07D48"> configObject</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">object</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> configObject</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> :</span><span style="color:#999999"> {};</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> added</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> skipped</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> updated</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#1E754F">  for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#999999"> [</span><span style="color:#B07D48">name</span><span style="color:#999999">,</span><span style="color:#B07D48"> entry</span><span style="color:#999999">]</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> mcpEntries</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> exists</span><span style="color:#999999"> =</span><span style="color:#998418"> Object</span><span style="color:#999999">.</span><span style="color:#998418">prototype</span><span style="color:#999999">.</span><span style="color:#B07D48">hasOwnProperty</span><span style="color:#999999">.</span><span style="color:#59873A">call</span><span style="color:#999999">(</span><span style="color:#B07D48">existingMcp</span><span style="color:#999999">,</span><span style="color:#B07D48"> name</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">exists</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#AB5959"> !</span><span style="color:#B07D48">options</span><span style="color:#999999">.</span><span style="color:#B07D48">force</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      skipped</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">(</span><span style="color:#B07D48">name</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#B07D48">    existingMcp</span><span style="color:#999999">[</span><span style="color:#B07D48">name</span><span style="color:#999999">]</span><span style="color:#999999"> =</span><span style="color:#B07D48"> entry</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">exists</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      updated</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">(</span><span style="color:#B07D48">name</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">    }</span><span style="color:#1E754F"> else</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      added</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">(</span><span style="color:#B07D48">name</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">added</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> updated</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    configObject</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#999999"> =</span><span style="color:#B07D48"> existingMcp</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> normalized</span><span style="color:#999999"> =</span><span style="color:#B07D48"> JSON</span><span style="color:#999999">.</span><span style="color:#59873A">stringify</span><span style="color:#999999">(</span><span style="color:#B07D48">configObject</span><span style="color:#999999">,</span><span style="color:#AB5959"> null</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> output</span><span style="color:#999999"> =</span><span style="color:#B07D48"> normalized</span><span style="color:#999999">.</span><span style="color:#59873A">endsWith</span><span style="color:#999999">(</span><span style="color:#B07D48">eol</span><span style="color:#999999">)</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> normalized</span><span style="color:#AB5959"> :</span><span style="color:#B5695977"> `</span><span style="color:#1E754F">${</span><span style="color:#B56959">normalized</span><span style="color:#1E754F">}${</span><span style="color:#B56959">eol</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">    fs</span><span style="color:#999999">.</span><span style="color:#59873A">writeFileSync</span><span style="color:#999999">(</span><span style="color:#B07D48">configPath</span><span style="color:#999999">,</span><span style="color:#B07D48"> output</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">utf8</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Updated </span><span style="color:#1E754F">${</span><span style="color:#B56959">path</span><span style="color:#999999">.</span><span style="color:#59873A">basename</span><span style="color:#999999">(</span><span style="color:#B56959">configPath</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B56959">.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span><span style="color:#1E754F"> else</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">No changes needed in </span><span style="color:#1E754F">${</span><span style="color:#B56959">path</span><span style="color:#999999">.</span><span style="color:#59873A">basename</span><span style="color:#999999">(</span><span style="color:#B56959">configPath</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B56959">.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">options</span><span style="color:#999999">.</span><span style="color:#B07D48">keep</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> payloadDir</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">.opencode</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">mcp</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> appliedDir</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">.applied</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#59873A">    ensureDir</span><span style="color:#999999">(</span><span style="color:#B07D48">appliedDir</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">    for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#B07D48"> filePath</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> payloadFiles</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">      const</span><span style="color:#B07D48"> relative</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">relative</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">,</span><span style="color:#B07D48"> filePath</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">relative</span><span style="color:#999999">.</span><span style="color:#59873A">startsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">..</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> relative</span><span style="color:#999999">.</span><span style="color:#59873A">startsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">.</span><span style="color:#1E754F">${</span><span style="color:#B56959">path</span><span style="color:#999999">.</span><span style="color:#B56959">sep</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">        continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">relative</span><span style="color:#999999">.</span><span style="color:#59873A">startsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">.applied</span><span style="color:#1E754F">${</span><span style="color:#B56959">path</span><span style="color:#999999">.</span><span style="color:#B56959">sep</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">        continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#AB5959">      const</span><span style="color:#B07D48"> baseName</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">basename</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">      let</span><span style="color:#B07D48"> target</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">appliedDir</span><span style="color:#999999">,</span><span style="color:#B07D48"> baseName</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">fs</span><span style="color:#999999">.</span><span style="color:#59873A">existsSync</span><span style="color:#999999">(</span><span style="color:#B07D48">target</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">        const</span><span style="color:#B07D48"> stamp</span><span style="color:#999999"> =</span><span style="color:#B07D48"> Date</span><span style="color:#999999">.</span><span style="color:#59873A">now</span><span style="color:#999999">();</span></span>
<span class="line"><span style="color:#B07D48">        target</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">appliedDir</span><span style="color:#999999">,</span><span style="color:#B5695977"> `</span><span style="color:#1E754F">${</span><span style="color:#B56959">baseName</span><span style="color:#1E754F">}</span><span style="color:#B56959">.</span><span style="color:#1E754F">${</span><span style="color:#B56959">stamp</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#B07D48">      fs</span><span style="color:#999999">.</span><span style="color:#59873A">renameSync</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">,</span><span style="color:#B07D48"> target</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">added</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Added MCP servers: </span><span style="color:#1E754F">${</span><span style="color:#B56959">added</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">, </span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">updated</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Updated MCP servers: </span><span style="color:#1E754F">${</span><span style="color:#B56959">updated</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">, </span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">skipped</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Skipped existing MCP servers: </span><span style="color:#1E754F">${</span><span style="color:#B56959">skipped</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">, </span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#1E754F">try</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#59873A">  main</span><span style="color:#999999">();</span></span>
<span class="line"><span style="color:#999999">}</span><span style="color:#1E754F"> catch</span><span style="color:#999999"> (</span><span style="color:#B07D48">error</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> message</span><span style="color:#999999"> =</span><span style="color:#B07D48"> error</span><span style="color:#AB5959"> instanceof</span><span style="color:#2E8F82"> Error</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> error</span><span style="color:#999999">.</span><span style="color:#B07D48">message</span><span style="color:#AB5959"> :</span><span style="color:#59873A"> String</span><span style="color:#999999">(</span><span style="color:#B07D48">error</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#B07D48">  console</span><span style="color:#999999">.</span><span style="color:#59873A">error</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">MCP merge failed: </span><span style="color:#1E754F">${</span><span style="color:#B56959">message</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#B07D48">  process</span><span style="color:#999999">.</span><span style="color:#59873A">exit</span><span style="color:#999999">(</span><span style="color:#2F798A">1</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"></span></code></pre>a:T835,<pre class="shiki vitesse-light" style="background-color:#ffffff;color:#393a34" tabindex="0"><code><span class="line"><span style="color:#999999">{</span></span>
<span class="line"><span style="color:#99841877">  "</span><span style="color:#998418">mcp</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#99841877">    "</span><span style="color:#998418">next-devtools</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#99841877">      "</span><span style="color:#998418">type</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#B5695977"> "</span><span style="color:#B56959">local</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#99841877">      "</span><span style="color:#998418">command</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#999999"> [</span><span style="color:#B5695977">"</span><span style="color:#B56959">npx</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">-y</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">next-devtools-mcp@latest</span><span style="color:#B5695977">"</span><span style="color:#999999">],</span></span>
<span class="line"><span style="color:#99841877">      "</span><span style="color:#998418">enabled</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#1E754F"> true</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"></span></code></pre>4:["$","div",null,{"className":"space-y-6","children":["$","$L7",null,{"opencodeVariant":{"$schema":"https://ui.shadcn.com/schema/registry-item.json","name":"nextjs-mcp-opencode","type":"registry:item","title":"Next.js MCP (OpenCode)","description":"Merge the Next.js DevTools MCP server into opencode.json/jsonc.","meta":{"concept":"nextjs-mcp","platform":"opencode","kind":["mcp","config","script"],"postInstall":"node .opencode/bin/merge-mcp.mjs","installPath":"nextjs-mcp-opencode.v1.json"},"files":[{"path":"registry/nextjs-mcp/opencode/files/bin/merge-mcp.mjs","type":"registry:file","target":"~/.opencode/bin/merge-mcp.mjs"},{"path":"registry/nextjs-mcp/opencode/files/mcp/next-devtools.json","type":"registry:file","target":"~/.opencode/mcp/next-devtools.json"}],"docs":"After install, run `node .opencode/bin/merge-mcp.mjs` to merge the MCP config into opencode.json/jsonc. Requires Next.js 16+. The merge script archives payloads in .opencode/mcp/.applied to avoid re-adding removed MCPs. JSONC comments are stripped when writing."},"basePath":"","codeBlocks":[{"id":"registry-nextjs-mcp-opencode-files-bin-merge-mcp-mjs","label":"merge-mcp.mjs","path":"registry/nextjs-mcp/opencode/files/bin/merge-mcp.mjs","target":"~/.opencode/bin/merge-mcp.mjs","raw":"$8","html":"$9","language":"js"},{"id":"registry-nextjs-mcp-opencode-files-mcp-next-devtools-json","label":"next-devtools.json","path":"registry/nextjs-mcp/opencode/files/mcp/next-devtools.json","target":"~/.opencode/mcp/next-devtools.json","raw":"{\n  \"mcp\": {\n    \"next-devtools\": {\n      \"type\": \"local\",\n      \"command\": [\"npx\", \"-y\", \"next-devtools-mcp@latest\"],\n      \"enabled\": true\n    }\n  }\n}\n","html":"$a","language":"json"}]}]}]
5:["$","script","script-0",{"src":"/_next/static/chunks/1d56de6fa4bb4a40.js","async":true}]
6:["$","$Lb",null,{"children":["$","$c",null,{"name":"Next.MetadataOutlet","children":"$@d"}]}]
d:null
