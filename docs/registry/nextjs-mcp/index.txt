1:"$Sreact.fragment"
2:I[63880,["/agent-utils/_next/static/chunks/e57f8bd634e3e83c.js","/agent-utils/_next/static/chunks/152d0cd9196fc828.js"],"default"]
3:I[93744,["/agent-utils/_next/static/chunks/e57f8bd634e3e83c.js","/agent-utils/_next/static/chunks/152d0cd9196fc828.js"],"default"]
5:I[71831,["/agent-utils/_next/static/chunks/e57f8bd634e3e83c.js","/agent-utils/_next/static/chunks/152d0cd9196fc828.js"],"OutletBoundary"]
6:"$Sreact.suspense"
8:I[71831,["/agent-utils/_next/static/chunks/e57f8bd634e3e83c.js","/agent-utils/_next/static/chunks/152d0cd9196fc828.js"],"ViewportBoundary"]
a:I[71831,["/agent-utils/_next/static/chunks/e57f8bd634e3e83c.js","/agent-utils/_next/static/chunks/152d0cd9196fc828.js"],"MetadataBoundary"]
c:I[78227,[],"default"]
:HL["/agent-utils/_next/static/chunks/ab0d30ff4f77c0f7.css","style"]
:HL["/agent-utils/_next/static/media/0c89a48fa5027cee-s.p.4564287c.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/agent-utils/_next/static/media/70bc3e132a0a741e-s.p.15008bfb.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/agent-utils/_next/static/chunks/1cc242b844a8c0ef.css","style"]
0:{"P":null,"b":"2pSTeKhGoSkpFbSrPmioL","c":["","registry","nextjs-mcp",""],"q":"","i":false,"f":[[["",{"children":["registry",{"children":[["concept","nextjs-mcp","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],[["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/agent-utils/_next/static/chunks/ab0d30ff4f77c0f7.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","className":"h-full","children":["$","body",null,{"className":"space_grotesk_a4177b3f-module__DCxVEW__variable jetbrains_mono_2b1eae20-module__XfFTLG__variable min-h-full font-sans","children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}],{"children":[["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":["$L4",[["$","link","0",{"rel":"stylesheet","href":"/agent-utils/_next/static/chunks/1cc242b844a8c0ef.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","script","script-0",{"src":"/agent-utils/_next/static/chunks/88049d1610f79db3.js","async":true,"nonce":"$undefined"}],["$","script","script-1",{"src":"/agent-utils/_next/static/chunks/122bbe670a0c62fe.js","async":true,"nonce":"$undefined"}],["$","script","script-2",{"src":"/agent-utils/_next/static/chunks/28ac2bf59af5b750.js","async":true,"nonce":"$undefined"}]],["$","$L5",null,{"children":["$","$6",null,{"name":"Next.MetadataOutlet","children":"$@7"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],["$","$1","h",{"children":[null,["$","$L8",null,{"children":"$@9"}],["$","div",null,{"hidden":true,"children":["$","$La",null,{"children":["$","$6",null,{"name":"Next.Metadata","children":"$@b"}]}]}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}],false]],"m":"$undefined","G":["$c",[]],"s":false,"S":true}
9:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
b:[["$","title","0",{"children":"Next.js MCP | Agent Utils Registry"}],["$","meta","1",{"name":"description","content":"Install Next.js DevTools MCP so OpenCode can query your dev server."}],["$","meta","2",{"name":"referrer","content":"no-referrer"}],["$","link","3",{"rel":"canonical","href":"https://brennanmceachran.github.io/agent-utils/registry/nextjs-mcp/"}],["$","meta","4",{"property":"og:title","content":"Next.js MCP | Agent Utils"}],["$","meta","5",{"property":"og:description","content":"Install Next.js DevTools MCP so OpenCode can query your dev server."}],["$","meta","6",{"property":"og:url","content":"https://brennanmceachran.github.io/agent-utils/registry/nextjs-mcp/"}],["$","meta","7",{"property":"og:image","content":"https://brennanmceachran.github.io/agent-utils/registry/nextjs-mcp/opengraph-image.png"}],["$","meta","8",{"property":"og:type","content":"article"}],["$","meta","9",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","10",{"name":"twitter:title","content":"Next.js MCP | Agent Utils"}],["$","meta","11",{"name":"twitter:description","content":"Install Next.js DevTools MCP so OpenCode can query your dev server."}],["$","meta","12",{"name":"twitter:image","content":"https://brennanmceachran.github.io/agent-utils/registry/nextjs-mcp/opengraph-image.png"}]]
7:null
d:I[27130,["/agent-utils/_next/static/chunks/88049d1610f79db3.js","/agent-utils/_next/static/chunks/122bbe670a0c62fe.js","/agent-utils/_next/static/chunks/28ac2bf59af5b750.js"],""]
4:["$","main",null,{"className":"min-h-screen bg-background","children":["$","div",null,{"className":"relative","children":[["$","div",null,{"className":"pointer-events-none absolute inset-0 overflow-hidden","children":[["$","div",null,{"className":"absolute -left-24 top-16 h-64 w-64 rounded-full bg-orange-200/30 blur-3xl"}],["$","div",null,{"className":"absolute right-[-120px] top-40 h-72 w-72 rounded-full bg-cyan-200/30 blur-3xl"}],["$","div",null,{"className":"absolute inset-0 bg-[linear-gradient(to_right,rgba(15,23,42,0.06)_1px,transparent_1px),linear-gradient(to_bottom,rgba(15,23,42,0.06)_1px,transparent_1px)] bg-[size:72px_72px] opacity-40"}]]}],["$","header",null,{"className":"sticky top-0 z-30 border-b border-border/60 bg-background/80 backdrop-blur","children":["$","div",null,{"className":"flex w-full items-center gap-6 px-4 py-3 sm:px-6 xl:px-10","children":[["$","$Ld",null,{"href":"/","className":"flex items-center gap-3","children":[["$","div",null,{"className":"flex h-10 w-10 items-center justify-center rounded-xl bg-slate-900 text-white shadow-sm","children":"AU"}],["$","div",null,{"className":"hidden sm:flex flex-col","children":["$","span",null,{"className":"text-xs font-semibold uppercase tracking-[0.24em] text-slate-600","children":"Agent Utils"}]}]]}],["$","nav",null,{"className":"hidden lg:flex items-center gap-4 text-sm font-medium text-muted-foreground","children":[["$","$Ld",null,{"href":"/","className":"hover:text-foreground","children":"Home"}],["$","$Ld",null,{"href":"/registry","className":"hover:text-foreground","children":"Registry"}]]}],["$","div",null,{"className":"ml-auto flex items-center gap-2","children":[["$","a",null,{"href":"https://github.com/brennanmceachran/agent-utils","target":"_blank","rel":"noreferrer","children":"GitHub","className":"items-center justify-center gap-2 rounded-lg text-sm font-semibold tracking-tight transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 ring-offset-background border border-border/70 bg-transparent text-foreground hover:bg-muted/70 h-11 px-5 py-2.5 hidden sm:inline-flex","ref":null}],["$","$Ld",null,{"href":"/registry","children":"Browse registry","className":"inline-flex items-center justify-center gap-2 rounded-lg text-sm font-semibold tracking-tight transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 ring-offset-background border border-border/70 bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/70 h-11 px-5 py-2.5","ref":null}]]}]]}]}],["$","div",null,{"className":"relative w-full px-4 pb-16 pt-6 sm:px-6 xl:px-10","children":["$","div",null,{"className":"mt-6 grid gap-8 lg:grid-cols-[minmax(200px,240px)_minmax(0,720px)_minmax(0,1fr)] xl:grid-cols-[minmax(240px,1fr)_minmax(0,760px)_minmax(240px,1fr)]","children":[["$","aside",null,{"className":"hidden lg:flex lg:flex-col lg:sticky lg:top-20 lg:h-[calc(100vh-6rem)] lg:justify-self-start lg:overflow-y-auto lg:pr-2","children":["$","div",null,{"className":"space-y-6","children":["$","div",null,{"className":"space-y-2","children":[["$","p",null,{"className":"text-xs font-semibold uppercase tracking-[0.24em] text-muted-foreground","children":"Registry"}],["$","nav",null,{"className":"space-y-1","children":[["$","$Ld","nextjs-mcp",{"href":"/registry/nextjs-mcp","aria-current":"page","className":"flex items-center justify-between rounded-xl px-3 py-2 text-sm font-medium transition bg-foreground text-background shadow-sm","children":["$","span",null,{"children":"Next.js MCP"}]}],["$","$Ld","ralph-loop",{"href":"/registry/ralph-loop","aria-current":"$undefined","className":"flex items-center justify-between rounded-xl px-3 py-2 text-sm font-medium transition text-muted-foreground hover:bg-muted/60 hover:text-foreground","children":"$Le"}],"$Lf"]}]]}]}]}],"$L10","$L11"]}]}]]}]}]
13:I[27655,["/agent-utils/_next/static/chunks/88049d1610f79db3.js","/agent-utils/_next/static/chunks/122bbe670a0c62fe.js","/agent-utils/_next/static/chunks/28ac2bf59af5b750.js"],"PlatformTabs"]
e:["$","span",null,{"children":"Ralph Loop"}]
f:["$","$Ld","webresearch",{"href":"/registry/webresearch","aria-current":"$undefined","className":"flex items-center justify-between rounded-xl px-3 py-2 text-sm font-medium transition text-muted-foreground hover:bg-muted/60 hover:text-foreground","children":["$","span",null,{"children":"Web Research"}]}]
14:T1b92,#!/usr/bin/env node

// scripts/merge-mcp.ts
import fs from "node:fs";
import path from "node:path";
var args = process.argv.slice(2);
var options = {
  keep: false,
  force: false
};
var payloadArgs = [];
for (const arg of args) {
  if (arg === "--keep") {
    options.keep = true;
    continue;
  }
  if (arg === "--force") {
    options.force = true;
    continue;
  }
  if (arg.startsWith("-")) {
    console.error(`Unknown option: ${arg}`);
    process.exit(1);
  }
  payloadArgs.push(arg);
}
function detectEol(text) {
  return text.includes(`\r
`) ? `\r
` : `
`;
}
function stripJsonComments(input) {
  let out = "";
  let inString = false;
  let stringChar = "";
  let escaped = false;
  for (let i = 0;i < input.length; i += 1) {
    const char = input[i];
    const next = input[i + 1];
    if (inString) {
      out += char;
      if (escaped) {
        escaped = false;
      } else if (char === "\\") {
        escaped = true;
      } else if (char === stringChar) {
        inString = false;
      }
      continue;
    }
    if (char === '"' || char === "'") {
      inString = true;
      stringChar = char;
      out += char;
      continue;
    }
    if (char === "/" && next === "/") {
      while (i < input.length && input[i] !== `
`) {
        i += 1;
      }
      out += `
`;
      continue;
    }
    if (char === "/" && next === "*") {
      i += 2;
      while (i < input.length && !(input[i] === "*" && input[i + 1] === "/")) {
        i += 1;
      }
      i += 1;
      continue;
    }
    out += char;
  }
  return out;
}
function stripTrailingCommas(input) {
  let out = "";
  let inString = false;
  let stringChar = "";
  let escaped = false;
  for (let i = 0;i < input.length; i += 1) {
    const char = input[i];
    if (inString) {
      out += char;
      if (escaped) {
        escaped = false;
      } else if (char === "\\") {
        escaped = true;
      } else if (char === stringChar) {
        inString = false;
      }
      continue;
    }
    if (char === '"' || char === "'") {
      inString = true;
      stringChar = char;
      out += char;
      continue;
    }
    if (char === ",") {
      let j = i + 1;
      while (j < input.length && /\s/.test(input[j] ?? "")) {
        j += 1;
      }
      if (j < input.length && (input[j] === "}" || input[j] === "]")) {
        continue;
      }
    }
    out += char;
  }
  return out;
}
function parseJsonc(text, label) {
  const sanitized = stripTrailingCommas(stripJsonComments(text));
  let data;
  try {
    data = JSON.parse(sanitized);
  } catch (error) {
    const message = error instanceof Error ? error.message : "Unknown JSON parse error";
    throw new Error(`Failed to parse ${label}: ${message}`);
  }
  if (!data || typeof data !== "object") {
    throw new Error(`Expected ${label} to be an object.`);
  }
  return data;
}
function readPayload(filePath) {
  const raw = fs.readFileSync(filePath, "utf8");
  const data = parseJsonc(raw, filePath);
  return data;
}
function resolvePayloads(cwd, explicit) {
  if (explicit.length) {
    return explicit.map((item) => path.resolve(cwd, item));
  }
  const payloadDir = path.join(cwd, ".opencode", "mcp");
  if (!fs.existsSync(payloadDir)) {
    return [];
  }
  const entries = fs.readdirSync(payloadDir, { withFileTypes: true });
  return entries.filter((entry) => entry.isFile() && (entry.name.endsWith(".json") || entry.name.endsWith(".jsonc"))).map((entry) => path.join(payloadDir, entry.name));
}
function getConfigPath(cwd) {
  const jsoncPath = path.join(cwd, "opencode.jsonc");
  if (fs.existsSync(jsoncPath))
    return jsoncPath;
  return path.join(cwd, "opencode.json");
}
function ensureDir(dirPath) {
  fs.mkdirSync(dirPath, { recursive: true });
}
function main() {
  const cwd = process.cwd();
  const payloadFiles = resolvePayloads(cwd, payloadArgs);
  if (!payloadFiles.length) {
    console.log("No MCP payloads found. Nothing to merge.");
    return;
  }
  const payloads = payloadFiles.map((filePath) => ({ filePath, payload: readPayload(filePath) }));
  const mcpEntries = [];
  for (const { filePath, payload } of payloads) {
    if (!payload.mcp || typeof payload.mcp !== "object") {
      console.warn(`Skipping ${filePath}: missing mcp object.`);
      continue;
    }
    for (const [name, entry] of Object.entries(payload.mcp)) {
      if (!entry || typeof entry !== "object") {
        console.warn(`Skipping ${filePath}: mcp.${name} is not an object.`);
        continue;
      }
      mcpEntries.push([name, entry]);
    }
  }
  if (!mcpEntries.length) {
    console.log("No valid MCP entries found. Nothing to merge.");
    return;
  }
  const configPath = getConfigPath(cwd);
  const configExists = fs.existsSync(configPath);
  const configText = configExists ? fs.readFileSync(configPath, "utf8") : `{}
`;
  const eol = detectEol(configText);
  const configData = parseJsonc(configText, path.basename(configPath));
  const configObject = configData;
  const existingMcp = configObject.mcp && typeof configObject.mcp === "object" ? configObject.mcp : {};
  const added = [];
  const skipped = [];
  const updated = [];
  for (const [name, entry] of mcpEntries) {
    const exists = Object.prototype.hasOwnProperty.call(existingMcp, name);
    if (exists && !options.force) {
      skipped.push(name);
      continue;
    }
    existingMcp[name] = entry;
    if (exists) {
      updated.push(name);
    } else {
      added.push(name);
    }
  }
  if (added.length || updated.length) {
    configObject.mcp = existingMcp;
    const normalized = JSON.stringify(configObject, null, 2);
    const output = normalized.endsWith(eol) ? normalized : `${normalized}${eol}`;
    fs.writeFileSync(configPath, output, "utf8");
    console.log(`Updated ${path.basename(configPath)}.`);
  } else {
    console.log(`No changes needed in ${path.basename(configPath)}.`);
  }
  if (!options.keep) {
    const payloadDir = path.join(cwd, ".opencode", "mcp");
    const appliedDir = path.join(payloadDir, ".applied");
    ensureDir(appliedDir);
    for (const filePath of payloadFiles) {
      const relative = path.relative(payloadDir, filePath);
      if (relative.startsWith("..") || relative.startsWith(`.${path.sep}`)) {
        continue;
      }
      if (relative.startsWith(`.applied${path.sep}`)) {
        continue;
      }
      const baseName = path.basename(filePath);
      let target = path.join(appliedDir, baseName);
      if (fs.existsSync(target)) {
        const stamp = Date.now();
        target = path.join(appliedDir, `${baseName}.${stamp}`);
      }
      fs.renameSync(filePath, target);
    }
  }
  if (added.length) {
    console.log(`Added MCP servers: ${added.join(", ")}`);
  }
  if (updated.length) {
    console.log(`Updated MCP servers: ${updated.join(", ")}`);
  }
  if (skipped.length) {
    console.log(`Skipped existing MCP servers: ${skipped.join(", ")}`);
  }
}
try {
  main();
} catch (error) {
  const message = error instanceof Error ? error.message : String(error);
  console.error(`MCP merge failed: ${message}`);
  process.exit(1);
}
15:T11d66,<pre class="shiki vitesse-light" style="background-color:#ffffff;color:#393a34" tabindex="0"><code><span class="line"><span style="color:#A0ADA0">#!/usr/bin/env node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0">// scripts/merge-mcp.ts</span></span>
<span class="line"><span style="color:#1E754F">import</span><span style="color:#B07D48"> fs</span><span style="color:#1E754F"> from</span><span style="color:#B5695977"> "</span><span style="color:#B56959">node:fs</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">import</span><span style="color:#B07D48"> path</span><span style="color:#1E754F"> from</span><span style="color:#B5695977"> "</span><span style="color:#B56959">node:path</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">var</span><span style="color:#B07D48"> args</span><span style="color:#999999"> =</span><span style="color:#B07D48"> process</span><span style="color:#999999">.</span><span style="color:#B07D48">argv</span><span style="color:#999999">.</span><span style="color:#59873A">slice</span><span style="color:#999999">(</span><span style="color:#2F798A">2</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">var</span><span style="color:#B07D48"> options</span><span style="color:#999999"> =</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#998418">  keep</span><span style="color:#999999">:</span><span style="color:#1E754F"> false</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#998418">  force</span><span style="color:#999999">:</span><span style="color:#1E754F"> false</span></span>
<span class="line"><span style="color:#999999">};</span></span>
<span class="line"><span style="color:#AB5959">var</span><span style="color:#B07D48"> payloadArgs</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#1E754F">for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#B07D48"> arg</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> args</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">arg</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">--keep</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    options</span><span style="color:#999999">.</span><span style="color:#B07D48">keep</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">arg</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">--force</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    options</span><span style="color:#999999">.</span><span style="color:#B07D48">force</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">arg</span><span style="color:#999999">.</span><span style="color:#59873A">startsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">-</span><span style="color:#B5695977">"</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">error</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Unknown option: </span><span style="color:#1E754F">${</span><span style="color:#B56959">arg</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#B07D48">    process</span><span style="color:#999999">.</span><span style="color:#59873A">exit</span><span style="color:#999999">(</span><span style="color:#2F798A">1</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#B07D48">  payloadArgs</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">(</span><span style="color:#B07D48">arg</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> detectEol</span><span style="color:#999999">(</span><span style="color:#B07D48">text</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> text</span><span style="color:#999999">.</span><span style="color:#59873A">includes</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#A65E2B">\r</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">)</span><span style="color:#AB5959"> ?</span><span style="color:#B5695977"> `</span><span style="color:#A65E2B">\r</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#AB5959"> :</span><span style="color:#B5695977"> `</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> stripJsonComments</span><span style="color:#999999">(</span><span style="color:#B07D48">input</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> out</span><span style="color:#999999"> =</span><span style="color:#B5695977"> ""</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> stringChar</span><span style="color:#999999"> =</span><span style="color:#B5695977"> ""</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">  for</span><span style="color:#999999"> (</span><span style="color:#AB5959">let</span><span style="color:#B07D48"> i</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><span style="color:#B07D48">i</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">;</span><span style="color:#B07D48"> i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> char</span><span style="color:#999999"> =</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#999999">];</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> next</span><span style="color:#999999"> =</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#999999">];</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">inString</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">escaped</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span><span style="color:#1E754F"> else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#A65E2B">\\</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span><span style="color:#1E754F"> else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B07D48"> stringChar</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> '</span><span style="color:#B56959">"</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">'</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">      stringChar</span><span style="color:#999999"> =</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">/</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B07D48"> next</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">/</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">      while</span><span style="color:#999999"> (</span><span style="color:#B07D48">i</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#999999">]</span><span style="color:#AB5959"> !==</span><span style="color:#B5695977"> `</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B5695977"> `</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">/</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B07D48"> next</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">*</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 2</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      while</span><span style="color:#999999"> (</span><span style="color:#B07D48">i</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#AB5959"> !</span><span style="color:#999999">(</span><span style="color:#B07D48">input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#999999">]</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">*</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#999999">]</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">/</span><span style="color:#B5695977">"</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#B07D48">      i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#B07D48">    out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> out</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> stripTrailingCommas</span><span style="color:#999999">(</span><span style="color:#B07D48">input</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> out</span><span style="color:#999999"> =</span><span style="color:#B5695977"> ""</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> stringChar</span><span style="color:#999999"> =</span><span style="color:#B5695977"> ""</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">  for</span><span style="color:#999999"> (</span><span style="color:#AB5959">let</span><span style="color:#B07D48"> i</span><span style="color:#999999"> =</span><span style="color:#2F798A"> 0</span><span style="color:#999999">;</span><span style="color:#B07D48">i</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">;</span><span style="color:#B07D48"> i</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> char</span><span style="color:#999999"> =</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">i</span><span style="color:#999999">];</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">inString</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">escaped</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span><span style="color:#1E754F"> else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#A65E2B">\\</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        escaped</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span><span style="color:#1E754F"> else</span><span style="color:#1E754F"> if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B07D48"> stringChar</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> false</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> '</span><span style="color:#B56959">"</span><span style="color:#B5695977">'</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">'</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      inString</span><span style="color:#999999"> =</span><span style="color:#1E754F"> true</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">      stringChar</span><span style="color:#999999"> =</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">      out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">char</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">,</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">      let</span><span style="color:#B07D48"> j</span><span style="color:#999999"> =</span><span style="color:#B07D48"> i</span><span style="color:#AB5959"> +</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">      while</span><span style="color:#999999"> (</span><span style="color:#B07D48">j</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#B5695977"> /</span><span style="color:#5A6AA6">\s</span><span style="color:#B5695977">/</span><span style="color:#999999">.</span><span style="color:#59873A">test</span><span style="color:#999999">(</span><span style="color:#B07D48">input</span><span style="color:#999999">[</span><span style="color:#B07D48">j</span><span style="color:#999999">]</span><span style="color:#AB5959"> ??</span><span style="color:#B5695977"> ""</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        j</span><span style="color:#AB5959"> +=</span><span style="color:#2F798A"> 1</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">j</span><span style="color:#999999"> &#x3C;</span><span style="color:#B07D48"> input</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#999999"> (</span><span style="color:#B07D48">input</span><span style="color:#999999">[</span><span style="color:#B07D48">j</span><span style="color:#999999">]</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">}</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> input</span><span style="color:#999999">[</span><span style="color:#B07D48">j</span><span style="color:#999999">]</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">]</span><span style="color:#B5695977">"</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">        continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#B07D48">    out</span><span style="color:#AB5959"> +=</span><span style="color:#B07D48"> char</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> out</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> parseJsonc</span><span style="color:#999999">(</span><span style="color:#B07D48">text</span><span style="color:#999999">,</span><span style="color:#B07D48"> label</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> sanitized</span><span style="color:#999999"> =</span><span style="color:#59873A"> stripTrailingCommas</span><span style="color:#999999">(</span><span style="color:#59873A">stripJsonComments</span><span style="color:#999999">(</span><span style="color:#B07D48">text</span><span style="color:#999999">));</span></span>
<span class="line"><span style="color:#AB5959">  let</span><span style="color:#B07D48"> data</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">  try</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    data</span><span style="color:#999999"> =</span><span style="color:#B07D48"> JSON</span><span style="color:#999999">.</span><span style="color:#59873A">parse</span><span style="color:#999999">(</span><span style="color:#B07D48">sanitized</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span><span style="color:#1E754F"> catch</span><span style="color:#999999"> (</span><span style="color:#B07D48">error</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> message</span><span style="color:#999999"> =</span><span style="color:#B07D48"> error</span><span style="color:#AB5959"> instanceof</span><span style="color:#2E8F82"> Error</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> error</span><span style="color:#999999">.</span><span style="color:#B07D48">message</span><span style="color:#AB5959"> :</span><span style="color:#B5695977"> "</span><span style="color:#B56959">Unknown JSON parse error</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    throw</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> Error</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Failed to parse </span><span style="color:#1E754F">${</span><span style="color:#B56959">label</span><span style="color:#1E754F">}</span><span style="color:#B56959">: </span><span style="color:#1E754F">${</span><span style="color:#B56959">message</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">data</span><span style="color:#AB5959"> ||</span><span style="color:#AB5959"> typeof</span><span style="color:#B07D48"> data</span><span style="color:#AB5959"> !==</span><span style="color:#B5695977"> "</span><span style="color:#B56959">object</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">    throw</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> Error</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Expected </span><span style="color:#1E754F">${</span><span style="color:#B56959">label</span><span style="color:#1E754F">}</span><span style="color:#B56959"> to be an object.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> data</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> readPayload</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> raw</span><span style="color:#999999"> =</span><span style="color:#B07D48"> fs</span><span style="color:#999999">.</span><span style="color:#59873A">readFileSync</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">utf8</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> data</span><span style="color:#999999"> =</span><span style="color:#59873A"> parseJsonc</span><span style="color:#999999">(</span><span style="color:#B07D48">raw</span><span style="color:#999999">,</span><span style="color:#B07D48"> filePath</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> data</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> resolvePayloads</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B07D48"> explicit</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">explicit</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#B07D48"> explicit</span><span style="color:#999999">.</span><span style="color:#59873A">map</span><span style="color:#999999">((</span><span style="color:#B07D48">item</span><span style="color:#999999">)</span><span style="color:#999999"> =></span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">resolve</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B07D48"> item</span><span style="color:#999999">));</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> payloadDir</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">.opencode</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">mcp</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">fs</span><span style="color:#999999">.</span><span style="color:#59873A">existsSync</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> entries</span><span style="color:#999999"> =</span><span style="color:#B07D48"> fs</span><span style="color:#999999">.</span><span style="color:#59873A">readdirSync</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">,</span><span style="color:#999999"> {</span><span style="color:#998418"> withFileTypes</span><span style="color:#999999">:</span><span style="color:#1E754F"> true</span><span style="color:#999999"> });</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> entries</span><span style="color:#999999">.</span><span style="color:#59873A">filter</span><span style="color:#999999">((</span><span style="color:#B07D48">entry</span><span style="color:#999999">)</span><span style="color:#999999"> =></span><span style="color:#B07D48"> entry</span><span style="color:#999999">.</span><span style="color:#59873A">isFile</span><span style="color:#999999">()</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#999999"> (</span><span style="color:#B07D48">entry</span><span style="color:#999999">.</span><span style="color:#B07D48">name</span><span style="color:#999999">.</span><span style="color:#59873A">endsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">.json</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> entry</span><span style="color:#999999">.</span><span style="color:#B07D48">name</span><span style="color:#999999">.</span><span style="color:#59873A">endsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">.jsonc</span><span style="color:#B5695977">"</span><span style="color:#999999">))).</span><span style="color:#59873A">map</span><span style="color:#999999">((</span><span style="color:#B07D48">entry</span><span style="color:#999999">)</span><span style="color:#999999"> =></span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">,</span><span style="color:#B07D48"> entry</span><span style="color:#999999">.</span><span style="color:#B07D48">name</span><span style="color:#999999">));</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> getConfigPath</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> jsoncPath</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">opencode.jsonc</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">fs</span><span style="color:#999999">.</span><span style="color:#59873A">existsSync</span><span style="color:#999999">(</span><span style="color:#B07D48">jsoncPath</span><span style="color:#999999">))</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#B07D48"> jsoncPath</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">opencode.json</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> ensureDir</span><span style="color:#999999">(</span><span style="color:#B07D48">dirPath</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">  fs</span><span style="color:#999999">.</span><span style="color:#59873A">mkdirSync</span><span style="color:#999999">(</span><span style="color:#B07D48">dirPath</span><span style="color:#999999">,</span><span style="color:#999999"> {</span><span style="color:#998418"> recursive</span><span style="color:#999999">:</span><span style="color:#1E754F"> true</span><span style="color:#999999"> });</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> main</span><span style="color:#999999">()</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> cwd</span><span style="color:#999999"> =</span><span style="color:#B07D48"> process</span><span style="color:#999999">.</span><span style="color:#59873A">cwd</span><span style="color:#999999">();</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> payloadFiles</span><span style="color:#999999"> =</span><span style="color:#59873A"> resolvePayloads</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B07D48"> payloadArgs</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">payloadFiles</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">No MCP payloads found. Nothing to merge.</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> payloads</span><span style="color:#999999"> =</span><span style="color:#B07D48"> payloadFiles</span><span style="color:#999999">.</span><span style="color:#59873A">map</span><span style="color:#999999">((</span><span style="color:#B07D48">filePath</span><span style="color:#999999">)</span><span style="color:#999999"> =></span><span style="color:#999999"> ({</span><span style="color:#B07D48"> filePath</span><span style="color:#999999">,</span><span style="color:#998418"> payload</span><span style="color:#999999">:</span><span style="color:#59873A"> readPayload</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">)</span><span style="color:#999999"> }));</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> mcpEntries</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#1E754F">  for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#999999"> {</span><span style="color:#B07D48"> filePath</span><span style="color:#999999">,</span><span style="color:#B07D48"> payload</span><span style="color:#999999"> }</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> payloads</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">payload</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> ||</span><span style="color:#AB5959"> typeof</span><span style="color:#B07D48"> payload</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> !==</span><span style="color:#B5695977"> "</span><span style="color:#B56959">object</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      console</span><span style="color:#999999">.</span><span style="color:#59873A">warn</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Skipping </span><span style="color:#1E754F">${</span><span style="color:#B56959">filePath</span><span style="color:#1E754F">}</span><span style="color:#B56959">: missing mcp object.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#1E754F">    for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#999999"> [</span><span style="color:#B07D48">name</span><span style="color:#999999">,</span><span style="color:#B07D48"> entry</span><span style="color:#999999">]</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> Object</span><span style="color:#999999">.</span><span style="color:#59873A">entries</span><span style="color:#999999">(</span><span style="color:#B07D48">payload</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">entry</span><span style="color:#AB5959"> ||</span><span style="color:#AB5959"> typeof</span><span style="color:#B07D48"> entry</span><span style="color:#AB5959"> !==</span><span style="color:#B5695977"> "</span><span style="color:#B56959">object</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">        console</span><span style="color:#999999">.</span><span style="color:#59873A">warn</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Skipping </span><span style="color:#1E754F">${</span><span style="color:#B56959">filePath</span><span style="color:#1E754F">}</span><span style="color:#B56959">: mcp.</span><span style="color:#1E754F">${</span><span style="color:#B56959">name</span><span style="color:#1E754F">}</span><span style="color:#B56959"> is not an object.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">        continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#B07D48">      mcpEntries</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">([</span><span style="color:#B07D48">name</span><span style="color:#999999">,</span><span style="color:#B07D48"> entry</span><span style="color:#999999">]);</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">mcpEntries</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">No valid MCP entries found. Nothing to merge.</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configPath</span><span style="color:#999999"> =</span><span style="color:#59873A"> getConfigPath</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configExists</span><span style="color:#999999"> =</span><span style="color:#B07D48"> fs</span><span style="color:#999999">.</span><span style="color:#59873A">existsSync</span><span style="color:#999999">(</span><span style="color:#B07D48">configPath</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configText</span><span style="color:#999999"> =</span><span style="color:#B07D48"> configExists</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> fs</span><span style="color:#999999">.</span><span style="color:#59873A">readFileSync</span><span style="color:#999999">(</span><span style="color:#B07D48">configPath</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">utf8</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#AB5959"> :</span><span style="color:#B5695977"> `</span><span style="color:#B56959">{}</span></span>
<span class="line"><span style="color:#B5695977">`</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> eol</span><span style="color:#999999"> =</span><span style="color:#59873A"> detectEol</span><span style="color:#999999">(</span><span style="color:#B07D48">configText</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configData</span><span style="color:#999999"> =</span><span style="color:#59873A"> parseJsonc</span><span style="color:#999999">(</span><span style="color:#B07D48">configText</span><span style="color:#999999">,</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">basename</span><span style="color:#999999">(</span><span style="color:#B07D48">configPath</span><span style="color:#999999">));</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> configObject</span><span style="color:#999999"> =</span><span style="color:#B07D48"> configData</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> existingMcp</span><span style="color:#999999"> =</span><span style="color:#B07D48"> configObject</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#AB5959"> typeof</span><span style="color:#B07D48"> configObject</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> ===</span><span style="color:#B5695977"> "</span><span style="color:#B56959">object</span><span style="color:#B5695977">"</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> configObject</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#AB5959"> :</span><span style="color:#999999"> {};</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> added</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> skipped</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> updated</span><span style="color:#999999"> =</span><span style="color:#999999"> [];</span></span>
<span class="line"><span style="color:#1E754F">  for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#999999"> [</span><span style="color:#B07D48">name</span><span style="color:#999999">,</span><span style="color:#B07D48"> entry</span><span style="color:#999999">]</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> mcpEntries</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> exists</span><span style="color:#999999"> =</span><span style="color:#998418"> Object</span><span style="color:#999999">.</span><span style="color:#998418">prototype</span><span style="color:#999999">.</span><span style="color:#B07D48">hasOwnProperty</span><span style="color:#999999">.</span><span style="color:#59873A">call</span><span style="color:#999999">(</span><span style="color:#B07D48">existingMcp</span><span style="color:#999999">,</span><span style="color:#B07D48"> name</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">exists</span><span style="color:#AB5959"> &#x26;&#x26;</span><span style="color:#AB5959"> !</span><span style="color:#B07D48">options</span><span style="color:#999999">.</span><span style="color:#B07D48">force</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      skipped</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">(</span><span style="color:#B07D48">name</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">      continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#B07D48">    existingMcp</span><span style="color:#999999">[</span><span style="color:#B07D48">name</span><span style="color:#999999">]</span><span style="color:#999999"> =</span><span style="color:#B07D48"> entry</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    if</span><span style="color:#999999"> (</span><span style="color:#B07D48">exists</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      updated</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">(</span><span style="color:#B07D48">name</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">    }</span><span style="color:#1E754F"> else</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">      added</span><span style="color:#999999">.</span><span style="color:#59873A">push</span><span style="color:#999999">(</span><span style="color:#B07D48">name</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">added</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> updated</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    configObject</span><span style="color:#999999">.</span><span style="color:#B07D48">mcp</span><span style="color:#999999"> =</span><span style="color:#B07D48"> existingMcp</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> normalized</span><span style="color:#999999"> =</span><span style="color:#B07D48"> JSON</span><span style="color:#999999">.</span><span style="color:#59873A">stringify</span><span style="color:#999999">(</span><span style="color:#B07D48">configObject</span><span style="color:#999999">,</span><span style="color:#AB5959"> null</span><span style="color:#999999">,</span><span style="color:#2F798A"> 2</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> output</span><span style="color:#999999"> =</span><span style="color:#B07D48"> normalized</span><span style="color:#999999">.</span><span style="color:#59873A">endsWith</span><span style="color:#999999">(</span><span style="color:#B07D48">eol</span><span style="color:#999999">)</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> normalized</span><span style="color:#AB5959"> :</span><span style="color:#B5695977"> `</span><span style="color:#1E754F">${</span><span style="color:#B56959">normalized</span><span style="color:#1E754F">}${</span><span style="color:#B56959">eol</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">    fs</span><span style="color:#999999">.</span><span style="color:#59873A">writeFileSync</span><span style="color:#999999">(</span><span style="color:#B07D48">configPath</span><span style="color:#999999">,</span><span style="color:#B07D48"> output</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">utf8</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Updated </span><span style="color:#1E754F">${</span><span style="color:#B56959">path</span><span style="color:#999999">.</span><span style="color:#59873A">basename</span><span style="color:#999999">(</span><span style="color:#B56959">configPath</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B56959">.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span><span style="color:#1E754F"> else</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">No changes needed in </span><span style="color:#1E754F">${</span><span style="color:#B56959">path</span><span style="color:#999999">.</span><span style="color:#59873A">basename</span><span style="color:#999999">(</span><span style="color:#B56959">configPath</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B56959">.</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#AB5959">!</span><span style="color:#B07D48">options</span><span style="color:#999999">.</span><span style="color:#B07D48">keep</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> payloadDir</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">cwd</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">.opencode</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">mcp</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">    const</span><span style="color:#B07D48"> appliedDir</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">.applied</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#59873A">    ensureDir</span><span style="color:#999999">(</span><span style="color:#B07D48">appliedDir</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">    for</span><span style="color:#999999"> (</span><span style="color:#AB5959">const</span><span style="color:#B07D48"> filePath</span><span style="color:#AB5959"> of</span><span style="color:#B07D48"> payloadFiles</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">      const</span><span style="color:#B07D48"> relative</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">relative</span><span style="color:#999999">(</span><span style="color:#B07D48">payloadDir</span><span style="color:#999999">,</span><span style="color:#B07D48"> filePath</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">relative</span><span style="color:#999999">.</span><span style="color:#59873A">startsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">..</span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#AB5959"> ||</span><span style="color:#B07D48"> relative</span><span style="color:#999999">.</span><span style="color:#59873A">startsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">.</span><span style="color:#1E754F">${</span><span style="color:#B56959">path</span><span style="color:#999999">.</span><span style="color:#B56959">sep</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">        continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">relative</span><span style="color:#999999">.</span><span style="color:#59873A">startsWith</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">.applied</span><span style="color:#1E754F">${</span><span style="color:#B56959">path</span><span style="color:#999999">.</span><span style="color:#B56959">sep</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#1E754F">        continue</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#AB5959">      const</span><span style="color:#B07D48"> baseName</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">basename</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#AB5959">      let</span><span style="color:#B07D48"> target</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">appliedDir</span><span style="color:#999999">,</span><span style="color:#B07D48"> baseName</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#1E754F">      if</span><span style="color:#999999"> (</span><span style="color:#B07D48">fs</span><span style="color:#999999">.</span><span style="color:#59873A">existsSync</span><span style="color:#999999">(</span><span style="color:#B07D48">target</span><span style="color:#999999">))</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">        const</span><span style="color:#B07D48"> stamp</span><span style="color:#999999"> =</span><span style="color:#B07D48"> Date</span><span style="color:#999999">.</span><span style="color:#59873A">now</span><span style="color:#999999">();</span></span>
<span class="line"><span style="color:#B07D48">        target</span><span style="color:#999999"> =</span><span style="color:#B07D48"> path</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B07D48">appliedDir</span><span style="color:#999999">,</span><span style="color:#B5695977"> `</span><span style="color:#1E754F">${</span><span style="color:#B56959">baseName</span><span style="color:#1E754F">}</span><span style="color:#B56959">.</span><span style="color:#1E754F">${</span><span style="color:#B56959">stamp</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">      }</span></span>
<span class="line"><span style="color:#B07D48">      fs</span><span style="color:#999999">.</span><span style="color:#59873A">renameSync</span><span style="color:#999999">(</span><span style="color:#B07D48">filePath</span><span style="color:#999999">,</span><span style="color:#B07D48"> target</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">added</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Added MCP servers: </span><span style="color:#1E754F">${</span><span style="color:#B56959">added</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">, </span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">updated</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Updated MCP servers: </span><span style="color:#1E754F">${</span><span style="color:#B56959">updated</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">, </span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">skipped</span><span style="color:#999999">.</span><span style="color:#998418">length</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#B07D48">    console</span><span style="color:#999999">.</span><span style="color:#59873A">log</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">Skipped existing MCP servers: </span><span style="color:#1E754F">${</span><span style="color:#B56959">skipped</span><span style="color:#999999">.</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#B56959">, </span><span style="color:#B5695977">"</span><span style="color:#999999">)</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"><span style="color:#1E754F">try</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#59873A">  main</span><span style="color:#999999">();</span></span>
<span class="line"><span style="color:#999999">}</span><span style="color:#1E754F"> catch</span><span style="color:#999999"> (</span><span style="color:#B07D48">error</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const</span><span style="color:#B07D48"> message</span><span style="color:#999999"> =</span><span style="color:#B07D48"> error</span><span style="color:#AB5959"> instanceof</span><span style="color:#2E8F82"> Error</span><span style="color:#AB5959"> ?</span><span style="color:#B07D48"> error</span><span style="color:#999999">.</span><span style="color:#B07D48">message</span><span style="color:#AB5959"> :</span><span style="color:#59873A"> String</span><span style="color:#999999">(</span><span style="color:#B07D48">error</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#B07D48">  console</span><span style="color:#999999">.</span><span style="color:#59873A">error</span><span style="color:#999999">(</span><span style="color:#B5695977">`</span><span style="color:#B56959">MCP merge failed: </span><span style="color:#1E754F">${</span><span style="color:#B56959">message</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#B07D48">  process</span><span style="color:#999999">.</span><span style="color:#59873A">exit</span><span style="color:#999999">(</span><span style="color:#2F798A">1</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"></span></code></pre>16:T835,<pre class="shiki vitesse-light" style="background-color:#ffffff;color:#393a34" tabindex="0"><code><span class="line"><span style="color:#999999">{</span></span>
<span class="line"><span style="color:#99841877">  "</span><span style="color:#998418">mcp</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#99841877">    "</span><span style="color:#998418">next-devtools</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#99841877">      "</span><span style="color:#998418">type</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#B5695977"> "</span><span style="color:#B56959">local</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#99841877">      "</span><span style="color:#998418">command</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#999999"> [</span><span style="color:#B5695977">"</span><span style="color:#B56959">npx</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">-y</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#B5695977"> "</span><span style="color:#B56959">next-devtools-mcp@latest</span><span style="color:#B5695977">"</span><span style="color:#999999">],</span></span>
<span class="line"><span style="color:#99841877">      "</span><span style="color:#998418">enabled</span><span style="color:#99841877">"</span><span style="color:#999999">:</span><span style="color:#1E754F"> true</span></span>
<span class="line"><span style="color:#999999">    }</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"></span></code></pre>10:["$","div",null,{"className":"min-w-0 max-w-full lg:justify-self-center","children":["$","div",null,{"className":"space-y-14","children":[["$","section",null,{"className":"space-y-6","children":[["$","div",null,{"className":"flex flex-wrap items-center gap-3","children":[["$","div",null,{"className":"inline-flex items-center rounded-full border px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.08em] transition-colors border-border/70 bg-white/70 text-muted-foreground","children":"OpenCode ready"}],["$","div",null,{"className":"inline-flex items-center rounded-full border px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.08em] transition-colors border-border/70 bg-white/70 text-muted-foreground","children":[1," ","variant"]}]]}],["$","div",null,{"className":"space-y-3","children":[["$","h1",null,{"className":"text-3xl font-semibold tracking-tight text-slate-900 sm:text-4xl","children":"Next.js MCP"}],["$","p",null,{"className":"text-lg text-muted-foreground","children":"Install Next.js DevTools MCP so OpenCode can query your dev server."}]]}],["$","section",null,{"id":"overview","className":"scroll-mt-24 space-y-6","children":["$","div",null,{"className":"markdown","children":"$L12"}]}]]}],["$","section",null,{"id":"install","className":"scroll-mt-24 space-y-6","children":[["$","div",null,{"className":"flex flex-wrap items-center justify-between gap-4","children":[["$","div",null,{"className":"space-y-2","children":[["$","p",null,{"className":"text-xs font-semibold uppercase tracking-[0.24em] text-muted-foreground","children":"Installation"}],["$","h2",null,{"className":"text-2xl font-semibold tracking-tight text-slate-900","children":"Install"}]]}],["$","div",null,{"className":"min-w-[220px]","children":["$","select",null,{"aria-label":"Platform","defaultValue":"opencode","className":"w-full rounded-xl border border-border/70 bg-white/80 px-3 py-2 text-sm font-medium text-foreground shadow-sm","children":[["$","option",null,{"value":"opencode","children":"OpenCode"}],["$","option",null,{"value":"claude","disabled":true,"children":"Claude Code (soon)"}],["$","option",null,{"value":"codex","disabled":true,"children":"Codex CLI (soon)"}]]}]}]]}],["$","div",null,{"className":"rounded-2xl border border-border/70 bg-white/80 p-6 shadow-sm","children":["$","$L13",null,{"opencodeVariant":{"$schema":"https://ui.shadcn.com/schema/registry-item.json","name":"nextjs-mcp-opencode","type":"registry:item","title":"Next.js MCP (OpenCode)","description":"Merge the Next.js DevTools MCP server into opencode.json/jsonc.","meta":{"concept":"nextjs-mcp","platform":"opencode","kind":["mcp","config","script"],"postInstall":"node .opencode/bin/merge-mcp.mjs"},"files":[{"path":"registry/nextjs-mcp/opencode/files/bin/merge-mcp.mjs","type":"registry:file","target":"~/.opencode/bin/merge-mcp.mjs"},{"path":"registry/nextjs-mcp/opencode/files/mcp/next-devtools.json","type":"registry:file","target":"~/.opencode/mcp/next-devtools.json"}],"docs":"After install, run `node .opencode/bin/merge-mcp.mjs` to merge the MCP config into opencode.json/jsonc. Requires Next.js 16+. The merge script archives payloads in .opencode/mcp/.applied to avoid re-adding removed MCPs. JSONC comments are stripped when writing."},"installCommand":"npx shadcn@latest add https://brennanmceachran.github.io/agent-utils/nextjs-mcp-opencode.json && node .opencode/bin/merge-mcp.mjs","installCommandHtml":"<pre class=\"shiki vitesse-light\" style=\"background-color:#ffffff;color:#393a34\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#59873A\">npx</span><span style=\"color:#B56959\"> shadcn@latest</span><span style=\"color:#B56959\"> add</span><span style=\"color:#B56959\"> https://brennanmceachran.github.io/agent-utils/nextjs-mcp-opencode.json</span><span style=\"color:#999999\"> &#x26;&#x26;</span><span style=\"color:#59873A\"> node</span><span style=\"color:#B56959\"> .opencode/bin/merge-mcp.mjs</span></span></code></pre>","codeBlocks":[{"id":"registry-nextjs-mcp-opencode-files-bin-merge-mcp-mjs","label":"bin/merge-mcp.mjs","path":"registry/nextjs-mcp/opencode/files/bin/merge-mcp.mjs","target":"~/.opencode/bin/merge-mcp.mjs","raw":"$14","html":"$15","language":"js"},{"id":"registry-nextjs-mcp-opencode-files-mcp-next-devtools-json","label":"mcp/next-devtools.json","path":"registry/nextjs-mcp/opencode/files/mcp/next-devtools.json","target":"~/.opencode/mcp/next-devtools.json","raw":"{\n  \"mcp\": {\n    \"next-devtools\": {\n      \"type\": \"local\",\n      \"command\": [\"npx\", \"-y\", \"next-devtools-mcp@latest\"],\n      \"enabled\": true\n    }\n  }\n}\n","html":"$16","language":"json"}]}]}]]}],"$L17","$L18","$L19","$L1a"]}]}]
11:["$","aside",null,{"className":"hidden xl:flex xl:flex-col xl:sticky xl:top-20 xl:h-[calc(100vh-6rem)] xl:justify-self-end xl:overflow-y-auto xl:pl-2","children":["$","div",null,{"className":"space-y-4","children":[["$","p",null,{"className":"text-xs font-semibold uppercase tracking-[0.24em] text-muted-foreground","children":"On this page"}],["$","nav",null,{"className":"space-y-2 text-sm text-muted-foreground","children":[["$","a","overview",{"href":"#overview","className":"block rounded-md px-2 py-1 transition hover:bg-muted/60 hover:text-foreground","children":"Overview"}],["$","a","install",{"href":"#install","className":"block rounded-md px-2 py-1 transition hover:bg-muted/60 hover:text-foreground","children":"Installation"}],["$","a","usage",{"href":"#usage","className":"block rounded-md px-2 py-1 transition hover:bg-muted/60 hover:text-foreground","children":"Usage"}],["$","a","examples",{"href":"#examples","className":"block rounded-md px-2 py-1 transition hover:bg-muted/60 hover:text-foreground","children":"Examples"}],["$","a","notes",{"href":"#notes","className":"block rounded-md px-2 py-1 transition hover:bg-muted/60 hover:text-foreground","children":"Notes"}]]}]]}]}]
17:["$","section",null,{"className":"space-y-6","children":["$","div",null,{"ref":"$undefined","className":"rounded-2xl border border-border/70 text-card-foreground shadow-sm backdrop-blur bg-white/80","children":[["$","div",null,{"ref":"$undefined","className":"flex flex-col space-y-2 p-6","children":["$","h3",null,{"ref":"$undefined","className":"text-base font-semibold tracking-tight","children":"Quick start"}]}],["$","div",null,{"ref":"$undefined","className":"p-6 pt-0","children":["$","div",null,{"className":"markdown","children":[["$","p",null,{"children":["$","strong",null,{"children":"What this gives you"}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Hooks OpenCode into the Next.js dev server MCP endpoint (",["$","code",null,{"children":"/_next/mcp"}],")."]}],"\n",["$","li",null,{"children":"Lets you read errors, logs, and routes without leaving the terminal."}],"\n",["$","li",null,{"children":["Adds ",["$","code",null,{"children":"next-devtools-mcp"}]," to ",["$","code",null,{"children":"opencode.json"}]," / ",["$","code",null,{"children":"opencode.jsonc"}],"."]}],"\n"]}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"Quickstart"}]}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"Install using the single command in the Install section above."}],"\n"]}],"\n",["$","p",null,{"children":["Manual install: add the contents of ",["$","code",null,{"children":".opencode/mcp/next-devtools.json"}]," under ",["$","code",null,{"children":"mcp"}]," in ",["$","code",null,{"children":"opencode.json"}]," or ",["$","code",null,{"children":"opencode.jsonc"}],"."]}],"\n",["$","ol",null,{"start":"2","children":["\n",["$","li",null,{"children":"Start your dev server (the MCP endpoint only exists while it is running):"}],"\n"]}],"\n","$L1b","\n",["$","ol",null,{"start":"3","children":["\n",["$","li",null,{"children":"Restart OpenCode so it reloads MCP config."}],"\n",["$","li",null,{"children":"Ask your agent:"}],"\n"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"\"Show me current Next.js errors\""}],"\n",["$","li",null,{"children":"\"List my routes\""}],"\n",["$","li",null,{"children":"\"Open the app and take a screenshot of /\""}],"\n"]}]]}]}]]}]}]
18:["$","section",null,{"id":"usage","className":"scroll-mt-24 space-y-6","children":[["$","div",null,{"className":"space-y-2","children":[["$","p",null,{"className":"text-xs font-semibold uppercase tracking-[0.24em] text-muted-foreground","children":"Usage"}],["$","h2",null,{"className":"text-2xl font-semibold tracking-tight text-slate-900","children":"How to use it well"}]]}],["$","div",null,{"ref":"$undefined","className":"rounded-2xl border border-border/70 bg-card/80 text-card-foreground shadow-sm backdrop-blur","children":["$","div",null,{"ref":"$undefined","className":"p-6 pt-6","children":["$","div",null,{"className":"markdown","children":[["$","h3",null,{"children":"1) Set expectations in your agent instructions"}],"\n",["$","p",null,{"children":"Add a short note to your agent instructions (for example AGENTS.md or your OpenCode agent file) so it always uses MCP and docs:"}],"\n","$L1c","\n",["$","h3",null,{"children":"2) Start with runtime reality"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Ask for ",["$","code",null,{"children":"get_errors"}]," and ",["$","code",null,{"children":"get_routes"}]," before touching code."]}],"\n",["$","li",null,{"children":["Use ",["$","code",null,{"children":"get_page_metadata"}]," when you are unsure what a route renders."]}],"\n"]}],"\n",["$","h3",null,{"children":"3) Use the browser for anything visual"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Ask for a screenshot and console errors after UI changes."}],"\n",["$","li",null,{"children":"When bugs only show in the browser, use Playwright to reproduce."}],"\n",["$","li",null,{"children":"Example: \"Open /, take a screenshot, and suggest UI improvements.\""}],"\n"]}],"\n",["$","h3",null,{"children":"4) Keep docs and upgrades close"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"When you hit a Next.js API question, ask the agent to query official docs."}],"\n",["$","li",null,{"children":"Use the upgrade and cache component helpers when you are migrating."}],"\n"]}],"\n",["$","h3",null,{"children":"5) Keep the loop tight"}],"\n",["$","p",null,{"children":"After each fix, re-check errors and verify the page again."}]]}]}]}]]}]
19:["$","section",null,{"id":"examples","className":"scroll-mt-24 space-y-6","children":[["$","div",null,{"className":"space-y-2","children":[["$","p",null,{"className":"text-xs font-semibold uppercase tracking-[0.24em] text-muted-foreground","children":"Examples"}],["$","h2",null,{"className":"text-2xl font-semibold tracking-tight text-slate-900","children":"Shared runs"}]]}],["$","div",null,{"ref":"$undefined","className":"rounded-2xl border border-border/70 bg-card/80 text-card-foreground shadow-sm backdrop-blur","children":["$","div",null,{"ref":"$undefined","className":"p-6 pt-6","children":["$","div",null,{"className":"markdown","children":["$","table",null,{"children":["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"Thread"}],["$","th",null,{"children":"Platform"}],["$","th",null,{"children":"What it shows"}],["$","th",null,{"children":"Link"}]]}]}]}]}]}]}]]}]
1a:["$","section",null,{"id":"notes","className":"scroll-mt-24 space-y-6","children":[["$","div",null,{"className":"space-y-2","children":[["$","p",null,{"className":"text-xs font-semibold uppercase tracking-[0.24em] text-muted-foreground","children":"Notes"}],["$","h2",null,{"className":"text-2xl font-semibold tracking-tight text-slate-900","children":"Notes"}]]}],["$","div",null,{"ref":"$undefined","className":"rounded-2xl border border-border/70 bg-card/80 text-card-foreground shadow-sm backdrop-blur","children":["$","div",null,{"ref":"$undefined","className":"p-6 pt-6","children":["$","div",null,{"className":"markdown","children":["$","p",null,{"children":"Requires Next.js 16+ and a running dev server; restart OpenCode after installing so MCP tools load."}]}]}]}]]}]
1d:I[57084,["/agent-utils/_next/static/chunks/88049d1610f79db3.js","/agent-utils/_next/static/chunks/122bbe670a0c62fe.js","/agent-utils/_next/static/chunks/28ac2bf59af5b750.js"],"TweetActionsRow"]
12:["$","div",null,{"className":"overflow-hidden rounded-2xl border border-border/70 bg-card/80 shadow-sm backdrop-blur","children":[["$","div",null,{"className":"relative w-full bg-slate-950","style":{"aspectRatio":"16 / 9"},"children":["$","video",null,{"className":"h-full w-full object-contain","controls":true,"playsInline":true,"preload":"metadata","poster":"https://pbs.twimg.com/amplify_video_thumb/1985507128652562433/img/G6I3tcFzsRbzV_Sp.jpg","aria-label":"Tweet video","crossOrigin":"anonymous","children":[["$","source",null,{"src":"https://video.twimg.com/amplify_video/1985507128652562433/vid/avc1/1280x720/9b1FQRFtkKMQ9vEt.mp4","type":"video/mp4"}],["$","track",null,{"kind":"captions","srcLang":"en","label":"English","src":"data:text/vtt,WEBVTT"}]]}]}],["$","div",null,{"className":"bg-card/80 px-6 py-4 border-t border-border/70","children":[["$","div",null,{"className":"relative","children":[["$","p",null,{"className":"pr-16 text-sm leading-snug text-slate-700","style":{"display":"-webkit-box","WebkitLineClamp":2,"WebkitBoxOrient":"vertical","overflow":"hidden"},"children":[["$","span","text-0-165",{"children":"Since Next.js 16, both browser and server logs will be captured and made accessible via MCP, allowing you to query and view logs from both ends directly in the agent"}]]}],["$","a",null,{"href":"https://x.com/huozhi/status/1985507710025060680","target":"_blank","rel":"noreferrer","className":"absolute bottom-0 right-1 z-10 whitespace-nowrap rounded-full bg-card/95 px-1.5 py-0.5 text-[0.7rem] font-medium text-muted-foreground shadow-sm transition hover:text-foreground","children":"Show more"}]]}],["$","$L1d",null,{"tweetUrl":"https://x.com/huozhi/status/1985507710025060680","likeUrl":"https://x.com/intent/like?tweet_id=1985507710025060680","replyUrl":"https://x.com/intent/tweet?in_reply_to=1985507710025060680","likeCount":11,"user":{"id_str":"2466181878","name":"Jiachi","screen_name":"huozhi","is_blue_verified":true,"profile_image_shape":"Circle","verified":false,"profile_image_url_https":"https://pbs.twimg.com/profile_images/1773459837264740353/Yjk7f1EY_normal.jpg","url":"https://x.com/huozhi","follow_url":"https://x.com/intent/follow?screen_name=huozhi"},"className":"mt-3"}]]}]]}]
1b:["$","div",null,{"className":"mt-3 overflow-x-auto rounded-xl border border-border/60 bg-muted/40 p-4 text-xs text-foreground","children":["$","div",null,{"className":"text-[13px]","children":["$","pre",null,{"className":"shiki vitesse-light","style":{"backgroundColor":"#ffffff","color":"#393a34"},"tabIndex":"0","children":["$","code",null,{"children":["$","span",null,{"className":"line","children":[["$","span","0",{"style":{"color":"#59873A"},"children":"npm"}],["$","span","1",{"style":{"color":"#B56959"},"children":" run"}],["$","span","2",{"style":{"color":"#B56959"},"children":" dev"}]]}]}]}]}]}]
1c:["$","div",null,{"className":"mt-3 overflow-x-auto rounded-xl border border-border/60 bg-muted/40 p-4 text-xs text-foreground","children":["$","div",null,{"className":"text-[13px]","children":["$","pre",null,{"className":"shiki vitesse-light","style":{"backgroundColor":"#ffffff","color":"#393a34"},"tabIndex":"0","children":["$","code",null,{"children":[["$","span","0",{"className":"line","children":["$","span",null,{"style":{"color":"#393A34"},"children":"When working on a Next.js project:"}]}],"\n",["$","span","2",{"className":"line","children":[["$","span","0",{"style":{"color":"#A65E2B"},"children":"-"}],["$","span","1",{"style":{"color":"#393A34"},"children":" call init at the start of the session"}]]}],"\n",["$","span","4",{"className":"line","children":[["$","span","0",{"style":{"color":"#A65E2B"},"children":"-"}],["$","span","1",{"style":{"color":"#393A34"},"children":" call nextjs_index before making changes"}]]}],"\n",["$","span","6",{"className":"line","children":[["$","span","0",{"style":{"color":"#A65E2B"},"children":"-"}],["$","span","1",{"style":{"color":"#393A34"},"children":" use nextjs_docs for Next.js questions"}]]}],"\n",["$","span","8",{"className":"line","children":[["$","span","0",{"style":{"color":"#A65E2B"},"children":"-"}],["$","span","1",{"style":{"color":"#393A34"},"children":" verify UI changes with browser tools"}]]}]]}]}]}]}]
