1:"$Sreact.fragment"
2:I[63880,["/_next/static/chunks/e57f8bd634e3e83c.js","/_next/static/chunks/152d0cd9196fc828.js"],"default"]
3:I[93744,["/_next/static/chunks/e57f8bd634e3e83c.js","/_next/static/chunks/152d0cd9196fc828.js"],"default"]
5:I[71831,["/_next/static/chunks/e57f8bd634e3e83c.js","/_next/static/chunks/152d0cd9196fc828.js"],"OutletBoundary"]
6:"$Sreact.suspense"
8:I[71831,["/_next/static/chunks/e57f8bd634e3e83c.js","/_next/static/chunks/152d0cd9196fc828.js"],"ViewportBoundary"]
a:I[71831,["/_next/static/chunks/e57f8bd634e3e83c.js","/_next/static/chunks/152d0cd9196fc828.js"],"MetadataBoundary"]
c:I[78227,["/_next/static/chunks/e57f8bd634e3e83c.js","/_next/static/chunks/152d0cd9196fc828.js"],"default"]
:HL["/_next/static/chunks/a184f9a797eb4044.css","style"]
:HL["/_next/static/media/0c89a48fa5027cee-s.p.4564287c.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
0:{"P":null,"b":"WKKgVDXOaSgstbYIPrNkF","c":["","registry","webresearch",""],"q":"","i":false,"f":[[["",{"children":["registry",{"children":[["concept","webresearch","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],[["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/chunks/a184f9a797eb4044.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","className":"h-full","children":["$","body",null,{"className":"space_grotesk_a4177b3f-module__DCxVEW__variable min-h-full font-sans","children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}],{"children":[["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":["$L4",[["$","script","script-0",{"src":"/_next/static/chunks/1d56de6fa4bb4a40.js","async":true,"nonce":"$undefined"}]],["$","$L5",null,{"children":["$","$6",null,{"name":"Next.MetadataOutlet","children":"$@7"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],["$","$1","h",{"children":[null,["$","$L8",null,{"children":"$@9"}],["$","div",null,{"hidden":true,"children":["$","$La",null,{"children":["$","$6",null,{"name":"Next.Metadata","children":"$@b"}]}]}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}],false]],"m":"$undefined","G":["$c",[]],"s":false,"S":true}
9:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
b:[["$","title","0",{"children":"Agent Utils Registry"}],["$","meta","1",{"name":"description","content":"Index-ready registry of OpenCode agent utilities with install-ready files."}]]
7:null
4:["$","main",null,{"className":"min-h-screen bg-background","children":["$","div",null,{"className":"mx-auto flex w-full max-w-6xl flex-col gap-10 px-6 py-16","children":[["$","header",null,{"className":"space-y-4","children":[["$","p",null,{"className":"text-sm font-semibold uppercase tracking-wide text-muted-foreground","children":"Concept"}],["$","div",null,{"className":"space-y-3","children":[["$","h1",null,{"className":"text-3xl font-semibold tracking-tight","children":"Web Research"}],["$","p",null,{"className":"text-muted-foreground","children":"OpenCode tool that runs Codex web search requests and returns structured summaries with sources."}]]}],["$","div",null,{"className":"flex flex-wrap gap-2","children":[["$","div","tool",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"tool"}],["$","div","research",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"research"}],["$","div","codex",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"codex"}],["$","div","sources",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"sources"}],["$","div","opencode",{"className":"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors text-foreground","children":"opencode"}]]}]]}],["$","section",null,{"className":"grid gap-8 lg:grid-cols-[1.2fr_0.8fr]","children":[["$","div",null,{"className":"space-y-6","children":[["$","div",null,{"ref":"$undefined","className":"rounded-xl border bg-card text-card-foreground shadow-sm","children":[["$","div",null,{"ref":"$undefined","className":"flex flex-col space-y-1.5 p-6","children":[["$","h3",null,{"ref":"$undefined","className":"text-lg font-semibold leading-none","children":"Why teams adopt it"}],["$","p",null,{"ref":"$undefined","className":"text-sm text-muted-foreground","children":"The outcomes this concept is designed to unlock."}]]}],["$","div",null,{"ref":"$undefined","className":"p-6 pt-0","children":["$","ul",null,{"className":"space-y-2 text-sm text-muted-foreground","children":[["$","li","Collect authoritative sources quickly without leaving the coding flow.",{"children":["• ","Collect authoritative sources quickly without leaving the coding flow."]}],["$","li","Standardize research output so decisions are traceable and reviewable.",{"children":["• ","Standardize research output so decisions are traceable and reviewable."]}],["$","li","Control depth with preset quality levels for faster or deeper dives.",{"children":["• ","Control depth with preset quality levels for faster or deeper dives."]}]]}]}]]}],["$","div",null,{"ref":"$undefined","className":"rounded-xl border bg-card text-card-foreground shadow-sm","children":[["$","div",null,{"ref":"$undefined","className":"flex flex-col space-y-1.5 p-6","children":[["$","h3",null,{"ref":"$undefined","className":"text-lg font-semibold leading-none","children":"What ships with it"}],["$","p",null,{"ref":"$undefined","className":"text-sm text-muted-foreground","children":"Core capabilities included in the OpenCode variant."}]]}],["$","div",null,{"ref":"$undefined","className":"p-6 pt-0","children":["$","ul",null,{"className":"space-y-2 text-sm text-muted-foreground","children":[["$","li","An OpenCode custom tool that invokes the codex CLI with web_search_request enabled.",{"children":["• ","An OpenCode custom tool that invokes the codex CLI with web_search_request enabled."]}],["$","li","Returns a concise summary, key findings, and full source URLs.",{"children":["• ","Returns a concise summary, key findings, and full source URLs."]}]]}]}]]}],["$","div",null,{"ref":"$undefined","className":"rounded-xl border bg-card text-card-foreground shadow-sm","children":[["$","div",null,{"ref":"$undefined","className":"flex flex-col space-y-1.5 p-6","children":["$","h3",null,{"ref":"$undefined","className":"text-lg font-semibold leading-none","children":"Common use cases"}]}],"$Ld"]}]]}],"$Le"]}]]}]}]
f:I[27655,["/_next/static/chunks/1d56de6fa4bb4a40.js"],"PlatformTabs"]
d:["$","div",null,{"ref":"$undefined","className":"p-6 pt-0","children":["$","ul",null,{"className":"space-y-2 text-sm text-muted-foreground","children":[["$","li","Validate API behavior or library changes before implementation.",{"children":["• ","Validate API behavior or library changes before implementation."]}],["$","li","Gather competitive or product research for planning docs.",{"children":["• ","Gather competitive or product research for planning docs."]}],["$","li","Verify compliance or licensing details with cited sources.",{"children":["• ","Verify compliance or licensing details with cited sources."]}]]}]}]
10:Tdf3,import { tool } from "@opencode-ai/plugin";

const QUALITY_PRESETS = {
  fast: {
    effort: "low",
    directive: "Keep it quick; use only the most relevant sources.",
  },
  balanced: {
    effort: "medium",
    directive: "Cover the main angles; resolve contradictions if they appear.",
  },
  deep: {
    effort: "high",
    directive:
      "Follow second-order leads and resolve contradictions until extra sources stop adding value.",
  },
} as const;

type Quality = keyof typeof QUALITY_PRESETS;

function buildPrompt({
  reason,
  query,
  additionalContext,
  quality,
}: {
  reason: string;
  query: string;
  additionalContext?: string;
  quality: Quality;
}) {
  const preset = QUALITY_PRESETS[quality];
  const contextBlock = additionalContext
    ? `Additional context (optional): ${additionalContext}`
    : "Additional context (optional):";

  return [
    "Hi, I’m stuck and need help with a research task.",
    "",
    `Reason: ${reason}`,
    `Search queries: ${query}`,
    contextBlock,
    `Depth: ${quality}`,
    "",
    "Please search the web and send back:",
    "- A 2-4 sentence summary",
    "- Key findings or caveats (bullets)",
    "- Sources with full URLs",
    "",
    "If anything is ambiguous, cover the plausible interpretations and state your assumptions instead of asking questions.",
    "Please don’t edit any code or files.",
    preset.directive,
  ].join("\n");
}

async function runCodex({
  prompt,
  effort,
}: {
  prompt: string;
  effort: string;
}) {
  const args = [
    "exec",
    "--enable",
    "web_search_request",
    "--sandbox",
    "read-only",
    "-c",
    `model_reasoning_effort=${effort}`,
    prompt,
  ];

  const proc = Bun.spawn(["codex", ...args], {
    stdout: "pipe",
    stderr: "pipe",
  });

  const [stdout, stderr] = await Promise.all([
    new Response(proc.stdout).text(),
    new Response(proc.stderr).text(),
  ]);
  const exitCode = await proc.exited;

  if (exitCode !== 0) {
    const message = stderr.trim() || `codex exec failed with exit code ${exitCode}`;
    throw new Error(message);
  }

  return stdout.trim();
}

export default tool({
  description:
    "Run a web search and return a concise summary with source links. Expect 5-10 minutes for deep queries; only run parallel calls for separate deep dives (one run can handle multiple related queries).",
  args: {
    reason: tool.schema
      .string()
      .describe(
        "Describe the core reason you’re reaching for web search and the decision or output you’re aiming for.",
      ),
    query: tool.schema
      .string()
      .describe(
        'List the search queries you want run; use new lines or ";" to include multiple angles in one run. Only split into parallel calls for distinct deep dives.',
      ),
    additional_context: tool.schema
      .string()
      .optional()
      .describe(
        "Add constraints or background: versions, product names, prior findings, relevant files/code, or must-include sources.",
      ),
    quality: tool.schema
      .enum(["fast", "balanced", "deep"])
      .describe(
        "Fast = quick scan, balanced = normal depth, deep = thorough with follow-up leads (deep can take 5-10 minutes).",
      ),
  },
  async execute(args) {
    const quality = args.quality as Quality;
    const prompt = buildPrompt({
      reason: args.reason,
      query: args.query,
      additionalContext: args.additional_context,
      quality,
    });

    const effort = QUALITY_PRESETS[quality].effort;
    return runCodex({
      prompt,
      effort,
    });
  },
});
11:T61a3,<pre class="shiki vitesse-light" style="background-color:#ffffff;color:#393a34" tabindex="0"><code><span class="line"><span style="color:#1E754F">import</span><span style="color:#999999"> {</span><span style="color:#B07D48"> tool</span><span style="color:#999999"> }</span><span style="color:#1E754F"> from</span><span style="color:#B5695977"> "</span><span style="color:#B56959">@opencode-ai/plugin</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959">const </span><span style="color:#B07D48">QUALITY_PRESETS</span><span style="color:#999999"> =</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#998418">  fast</span><span style="color:#999999">: {</span></span>
<span class="line"><span style="color:#998418">    effort</span><span style="color:#999999">: </span><span style="color:#B5695977">"</span><span style="color:#B56959">low</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#998418">    directive</span><span style="color:#999999">: </span><span style="color:#B5695977">"</span><span style="color:#B56959">Keep it quick; use only the most relevant sources.</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">  },</span></span>
<span class="line"><span style="color:#998418">  balanced</span><span style="color:#999999">: {</span></span>
<span class="line"><span style="color:#998418">    effort</span><span style="color:#999999">: </span><span style="color:#B5695977">"</span><span style="color:#B56959">medium</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#998418">    directive</span><span style="color:#999999">: </span><span style="color:#B5695977">"</span><span style="color:#B56959">Cover the main angles; resolve contradictions if they appear.</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">  },</span></span>
<span class="line"><span style="color:#998418">  deep</span><span style="color:#999999">: {</span></span>
<span class="line"><span style="color:#998418">    effort</span><span style="color:#999999">: </span><span style="color:#B5695977">"</span><span style="color:#B56959">high</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#998418">    directive</span><span style="color:#999999">:</span></span>
<span class="line"><span style="color:#B5695977">      "</span><span style="color:#B56959">Follow second-order leads and resolve contradictions until extra sources stop adding value.</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">  },</span></span>
<span class="line"><span style="color:#999999">}</span><span style="color:#1E754F"> as</span><span style="color:#AB5959"> const</span><span style="color:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959">type</span><span style="color:#2E8F82"> Quality</span><span style="color:#999999"> =</span><span style="color:#AB5959"> keyof</span><span style="color:#AB5959"> typeof</span><span style="color:#B07D48"> QUALITY_PRESETS</span><span style="color:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959">function</span><span style="color:#59873A"> buildPrompt</span><span style="color:#999999">({</span></span>
<span class="line"><span style="color:#B07D48">  reason</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B07D48">  query</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B07D48">  additionalContext</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B07D48">  quality</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">}: {</span></span>
<span class="line"><span style="color:#B07D48">  reason</span><span style="color:#999999">: </span><span style="color:#2E8F82">string</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">  query</span><span style="color:#999999">: </span><span style="color:#2E8F82">string</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">  additionalContext</span><span style="color:#AB5959">?</span><span style="color:#999999">: </span><span style="color:#2E8F82">string</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">  quality</span><span style="color:#999999">: </span><span style="color:#2E8F82">Quality</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">})</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const </span><span style="color:#B07D48">preset</span><span style="color:#999999"> =</span><span style="color:#B07D48"> QUALITY_PRESETS</span><span style="color:#999999">[</span><span style="color:#B07D48">quality</span><span style="color:#999999">];</span></span>
<span class="line"><span style="color:#AB5959">  const </span><span style="color:#B07D48">contextBlock</span><span style="color:#999999"> =</span><span style="color:#B07D48"> additionalContext</span></span>
<span class="line"><span style="color:#AB5959">    ?</span><span style="color:#B5695977"> `</span><span style="color:#B56959">Additional context (optional): </span><span style="color:#1E754F">${</span><span style="color:#B56959">additionalContext</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span></span>
<span class="line"><span style="color:#AB5959">    :</span><span style="color:#B5695977"> "</span><span style="color:#B56959">Additional context (optional):</span><span style="color:#B5695977">"</span><span style="color:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#999999"> [</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">Hi, I’m stuck and need help with a research task.</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    ""</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    `</span><span style="color:#B56959">Reason: </span><span style="color:#1E754F">${</span><span style="color:#B56959">reason</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    `</span><span style="color:#B56959">Search queries: </span><span style="color:#1E754F">${</span><span style="color:#B56959">query</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B07D48">    contextBlock</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    `</span><span style="color:#B56959">Depth: </span><span style="color:#1E754F">${</span><span style="color:#B56959">quality</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    ""</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">Please search the web and send back:</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">- A 2-4 sentence summary</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">- Key findings or caveats (bullets)</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">- Sources with full URLs</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    ""</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">If anything is ambiguous, cover the plausible interpretations and state your assumptions instead of asking questions.</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">Please don’t edit any code or files.</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B07D48">    preset</span><span style="color:#999999">.</span><span style="color:#B07D48">directive</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">  ].</span><span style="color:#59873A">join</span><span style="color:#999999">(</span><span style="color:#B5695977">"</span><span style="color:#A65E2B">\n</span><span style="color:#B5695977">"</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959">async</span><span style="color:#AB5959"> function</span><span style="color:#59873A"> runCodex</span><span style="color:#999999">({</span></span>
<span class="line"><span style="color:#B07D48">  prompt</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B07D48">  effort</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">}: {</span></span>
<span class="line"><span style="color:#B07D48">  prompt</span><span style="color:#999999">: </span><span style="color:#2E8F82">string</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#B07D48">  effort</span><span style="color:#999999">: </span><span style="color:#2E8F82">string</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#999999">})</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">  const </span><span style="color:#B07D48">args</span><span style="color:#999999"> =</span><span style="color:#999999"> [</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">exec</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">--enable</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">web_search_request</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">--sandbox</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">read-only</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">-c</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B5695977">    `</span><span style="color:#B56959">model_reasoning_effort=</span><span style="color:#1E754F">${</span><span style="color:#B56959">effort</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B07D48">    prompt</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">  ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959">  const </span><span style="color:#B07D48">proc</span><span style="color:#999999"> =</span><span style="color:#B07D48"> Bun</span><span style="color:#999999">.</span><span style="color:#59873A">spawn</span><span style="color:#999999">([</span><span style="color:#B5695977">"</span><span style="color:#B56959">codex</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span><span style="color:#999999"> ...</span><span style="color:#B07D48">args</span><span style="color:#999999">],</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#998418">    stdout</span><span style="color:#999999">: </span><span style="color:#B5695977">"</span><span style="color:#B56959">pipe</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#998418">    stderr</span><span style="color:#999999">: </span><span style="color:#B5695977">"</span><span style="color:#B56959">pipe</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959">  const </span><span style="color:#999999">[</span><span style="color:#B07D48">stdout</span><span style="color:#999999">,</span><span style="color:#B07D48"> stderr</span><span style="color:#999999">]</span><span style="color:#999999"> =</span><span style="color:#1E754F"> await</span><span style="color:#998418"> Promise</span><span style="color:#999999">.</span><span style="color:#59873A">all</span><span style="color:#999999">([</span></span>
<span class="line"><span style="color:#AB5959">    new </span><span style="color:#59873A">Response</span><span style="color:#999999">(</span><span style="color:#B07D48">proc</span><span style="color:#999999">.</span><span style="color:#B07D48">stdout</span><span style="color:#999999">).</span><span style="color:#59873A">text</span><span style="color:#999999">(),</span></span>
<span class="line"><span style="color:#AB5959">    new </span><span style="color:#59873A">Response</span><span style="color:#999999">(</span><span style="color:#B07D48">proc</span><span style="color:#999999">.</span><span style="color:#B07D48">stderr</span><span style="color:#999999">).</span><span style="color:#59873A">text</span><span style="color:#999999">(),</span></span>
<span class="line"><span style="color:#999999">  ]);</span></span>
<span class="line"><span style="color:#AB5959">  const </span><span style="color:#B07D48">exitCode</span><span style="color:#999999"> =</span><span style="color:#1E754F"> await</span><span style="color:#B07D48"> proc</span><span style="color:#999999">.</span><span style="color:#B07D48">exited</span><span style="color:#999999">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F">  if</span><span style="color:#999999"> (</span><span style="color:#B07D48">exitCode</span><span style="color:#AB5959"> !==</span><span style="color:#2F798A"> 0</span><span style="color:#999999">)</span><span style="color:#999999"> {</span></span>
<span class="line"><span style="color:#AB5959">    const </span><span style="color:#B07D48">message</span><span style="color:#999999"> =</span><span style="color:#B07D48"> stderr</span><span style="color:#999999">.</span><span style="color:#59873A">trim</span><span style="color:#999999">()</span><span style="color:#AB5959"> || </span><span style="color:#B5695977">`</span><span style="color:#B56959">codex exec failed with exit code </span><span style="color:#1E754F">${</span><span style="color:#B56959">exitCode</span><span style="color:#1E754F">}</span><span style="color:#B5695977">`</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    throw</span><span style="color:#AB5959"> new</span><span style="color:#59873A"> Error</span><span style="color:#999999">(</span><span style="color:#B07D48">message</span><span style="color:#999999">);</span></span>
<span class="line"><span style="color:#999999">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F">  return</span><span style="color:#B07D48"> stdout</span><span style="color:#999999">.</span><span style="color:#59873A">trim</span><span style="color:#999999">();</span></span>
<span class="line"><span style="color:#999999">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F">export</span><span style="color:#1E754F"> default</span><span style="color:#59873A"> tool</span><span style="color:#999999">({</span></span>
<span class="line"><span style="color:#998418">  description</span><span style="color:#999999">:</span></span>
<span class="line"><span style="color:#B5695977">    "</span><span style="color:#B56959">Run a web search and return a concise summary with source links. Expect 5-10 minutes for deep queries; only run parallel calls for separate deep dives (one run can handle multiple related queries).</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#998418">  args</span><span style="color:#999999">: {</span></span>
<span class="line"><span style="color:#998418">    reason</span><span style="color:#999999">: </span><span style="color:#B07D48">tool</span><span style="color:#999999">.</span><span style="color:#B07D48">schema</span></span>
<span class="line"><span style="color:#999999">      .</span><span style="color:#59873A">string</span><span style="color:#999999">()</span></span>
<span class="line"><span style="color:#999999">      .</span><span style="color:#59873A">describe</span><span style="color:#999999">(</span></span>
<span class="line"><span style="color:#B5695977">        "</span><span style="color:#B56959">Describe the core reason you’re reaching for web search and the decision or output you’re aiming for.</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">      ),</span></span>
<span class="line"><span style="color:#998418">    query</span><span style="color:#999999">: </span><span style="color:#B07D48">tool</span><span style="color:#999999">.</span><span style="color:#B07D48">schema</span></span>
<span class="line"><span style="color:#999999">      .</span><span style="color:#59873A">string</span><span style="color:#999999">()</span></span>
<span class="line"><span style="color:#999999">      .</span><span style="color:#59873A">describe</span><span style="color:#999999">(</span></span>
<span class="line"><span style="color:#B5695977">        '</span><span style="color:#B56959">List the search queries you want run; use new lines or ";" to include multiple angles in one run. Only split into parallel calls for distinct deep dives.</span><span style="color:#B5695977">'</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">      ),</span></span>
<span class="line"><span style="color:#998418">    additional_context</span><span style="color:#999999">: </span><span style="color:#B07D48">tool</span><span style="color:#999999">.</span><span style="color:#B07D48">schema</span></span>
<span class="line"><span style="color:#999999">      .</span><span style="color:#59873A">string</span><span style="color:#999999">()</span></span>
<span class="line"><span style="color:#999999">      .</span><span style="color:#59873A">optional</span><span style="color:#999999">()</span></span>
<span class="line"><span style="color:#999999">      .</span><span style="color:#59873A">describe</span><span style="color:#999999">(</span></span>
<span class="line"><span style="color:#B5695977">        "</span><span style="color:#B56959">Add constraints or background: versions, product names, prior findings, relevant files/code, or must-include sources.</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">      ),</span></span>
<span class="line"><span style="color:#998418">    quality</span><span style="color:#999999">: </span><span style="color:#B07D48">tool</span><span style="color:#999999">.</span><span style="color:#B07D48">schema</span></span>
<span class="line"><span style="color:#999999">      .</span><span style="color:#59873A">enum</span><span style="color:#999999">([</span><span style="color:#B5695977">"</span><span style="color:#B56959">fast</span><span style="color:#B5695977">"</span><span style="color:#999999">, </span><span style="color:#B5695977">"</span><span style="color:#B56959">balanced</span><span style="color:#B5695977">"</span><span style="color:#999999">, </span><span style="color:#B5695977">"</span><span style="color:#B56959">deep</span><span style="color:#B5695977">"</span><span style="color:#999999">])</span></span>
<span class="line"><span style="color:#999999">      .</span><span style="color:#59873A">describe</span><span style="color:#999999">(</span></span>
<span class="line"><span style="color:#B5695977">        "</span><span style="color:#B56959">Fast = quick scan, balanced = normal depth, deep = thorough with follow-up leads (deep can take 5-10 minutes).</span><span style="color:#B5695977">"</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">      ),</span></span>
<span class="line"><span style="color:#999999">  },</span></span>
<span class="line"><span style="color:#AB5959">  async</span><span style="color:#59873A"> execute</span><span style="color:#999999">(</span><span style="color:#B07D48">args</span><span style="color:#999999">) {</span></span>
<span class="line"><span style="color:#AB5959">    const </span><span style="color:#B07D48">quality</span><span style="color:#999999"> =</span><span style="color:#B07D48"> args</span><span style="color:#999999">.</span><span style="color:#B07D48">quality</span><span style="color:#1E754F"> as</span><span style="color:#2E8F82"> Quality</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#AB5959">    const </span><span style="color:#B07D48">prompt</span><span style="color:#999999"> =</span><span style="color:#59873A"> buildPrompt</span><span style="color:#999999">({</span></span>
<span class="line"><span style="color:#998418">      reason</span><span style="color:#999999">: </span><span style="color:#B07D48">args</span><span style="color:#999999">.</span><span style="color:#B07D48">reason</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#998418">      query</span><span style="color:#999999">: </span><span style="color:#B07D48">args</span><span style="color:#999999">.</span><span style="color:#B07D48">query</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#998418">      additionalContext</span><span style="color:#999999">: </span><span style="color:#B07D48">args</span><span style="color:#999999">.</span><span style="color:#B07D48">additional_context</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B07D48">      quality</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959">    const </span><span style="color:#B07D48">effort</span><span style="color:#999999"> =</span><span style="color:#B07D48"> QUALITY_PRESETS</span><span style="color:#999999">[</span><span style="color:#B07D48">quality</span><span style="color:#999999">].</span><span style="color:#B07D48">effort</span><span style="color:#999999">;</span></span>
<span class="line"><span style="color:#1E754F">    return</span><span style="color:#59873A"> runCodex</span><span style="color:#999999">({</span></span>
<span class="line"><span style="color:#B07D48">      prompt</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#B07D48">      effort</span><span style="color:#999999">,</span></span>
<span class="line"><span style="color:#999999">    });</span></span>
<span class="line"><span style="color:#999999">  },</span></span>
<span class="line"><span style="color:#999999">});</span></span>
<span class="line"></span></code></pre>e:["$","div",null,{"className":"space-y-6","children":["$","$Lf",null,{"opencodeVariant":{"$schema":"https://ui.shadcn.com/schema/registry-item.json","name":"webresearch-opencode","type":"registry:item","title":"OpenCode Web Research","description":"Web research tool that runs Codex web_search_request via OpenCode.","meta":{"concept":"webresearch","platform":"opencode","kind":["tool"],"installPath":"webresearch-opencode.v1.json"},"files":[{"path":"registry/webresearch/opencode/files/tool/webresearch.ts","type":"registry:file","target":"~/.opencode/tool/webresearch.ts"}],"docs":"Requires the `codex` CLI on PATH. Restart OpenCode after installing to register the tool. Targets prefixed with ~ are repo-scoped (project-root) paths."},"basePath":"","codeBlocks":[{"id":"registry-webresearch-opencode-files-tool-webresearch-ts","label":"webresearch.ts","path":"registry/webresearch/opencode/files/tool/webresearch.ts","target":"~/.opencode/tool/webresearch.ts","raw":"$10","html":"$11","language":"ts"}]}]}]
